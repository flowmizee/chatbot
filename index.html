<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
    <title>Chat Web Estilo WhatsApp</title>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.12.313/pdf.min.js"></script>
    
    <style>
      html, body {
        margin: 0;
        padding: 0;
        font-family: 'Segoe UI', sans-serif;
        height: 100%;
        background-color: #ece5dd;
      }
      body {
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .chat-container {
        width: 100%;
        height: 100dvh;
        max-width: 430px;
        background-color: #fff;
        display: flex;
        flex-direction: column;
        box-shadow: 0 0 10px rgba(0,0,0,0.2);
        position: relative;
      }
      .chat-header {
        background-color: #075E54;
        padding: 10px 15px;
        display: flex;
        align-items: center;
        color: white;
      }
      .chat-header img {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        margin-right: 12px;
        object-fit: cover;
      }
      .chat-header .name {
        font-size: 18px;
        font-weight: bold;
      }
      .chat-body {
        flex: 1;
        padding: 15px;
        overflow-y: auto;
        background-color: #e5ddd5;
        display: flex;
        flex-direction: column;
      }
      .message {
        max-width: 75%;
        padding: 10px 14px;
        margin-bottom: 8px;
        font-size: 15px;
        border-radius: 8px;
        line-height: 1.4;
        word-wrap: break-word;
      }
      .user {
        align-self: flex-end;
        background-color: #dcf8c6;
        border-bottom-right-radius: 0;
      }
      .bot {
        align-self: flex-start;
        background-color: white;
        border-bottom-left-radius: 0;
      }
      .typing-indicator {
        align-self: flex-start;
        background-color: white;
        border-bottom-left-radius: 0;
        max-width: 50px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 8px;
        margin-bottom: 8px;
        padding: 5px 10px;
      }
      .typing-indicator span {
        display: inline-block;
        width: 6px;
        height: 6px;
        margin: 0 1px;
        background-color: #999;
        border-radius: 50%;
        animation: blink 1.4s infinite both;
      }
      .typing-indicator span:nth-child(2) {
        animation-delay: 0.2s;
      }
      .typing-indicator span:nth-child(3) {
        animation-delay: 0.4s;
      }
      @keyframes blink {
        0%, 80%, 100% { opacity: 0; }
        40% { opacity: 1; }
      }
      .chat-footer {
        display: flex;
        padding: 8px 10px;
        background-color: #fff;
        border-top: 1px solid #ccc;
        align-items: center;
        position: relative;
      }
      .chat-footer input {
        flex: 1;
        padding: 12px;
        border: none;
        font-size: 16px;
        border-radius: 20px;
        margin-right: 8px;
        background-color: #f0f0f0;
        outline: none;
      }
      .chat-footer button#actionButton {
        width: 40px;
        height: 40px;
        background-color: #1bac5f;
        border: none;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
      }
      .chat-footer button#actionButton img {
        width: 20px;
        height: 20px;
      }
      .option-buttons {
        display: flex;
        gap: 10px;
        margin-top: 10px;
        flex-wrap: wrap;
      }
      .option-button {
        background-color: #075E54;
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 20px;
        cursor: pointer;
        font-size: 14px;
      }
      .option-button:hover {
        background-color: #0b7a67;
      }
      .preview-image {
        max-width: 100%;
        border-radius: 8px;
        margin-top: 10px;
      }
      .buy-button {
        background-color: #25D366;
        color: white;
        border: none;
        padding: 12px 20px;
        border-radius: 20px;
        cursor: pointer;
        font-size: 16px;
        font-weight: bold;
        margin-top: 15px;
        display: inline-block;
        width: 100%;
        text-align: center;
      }
      .buy-button:hover {
        background-color: #128C7E;
      }
      .testimonial-image {
        max-width: 100%;
        border-radius: 8px;
        margin-top: 10px;
        border: 2px solid #075E54;
      }
      .profile-image {
        max-width: 200px;
        border-radius: 8px;
        margin-top: 10px;
        border: 2px solid #075E54;
      }
      .buy-options {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-top: 15px;
      }
      .upload-label {
        display: inline-block;
        padding: 10px 15px;
        background-color: #075E54;
        color: white;
        border-radius: 20px;
        cursor: pointer;
        margin-top: 10px;
        margin-right: 10px;
      }
      .upload-label img {
        width: 20px;
        height: 20px;
        vertical-align: middle;
        margin-right: 8px;
      }
      #uploadComprovanteFoto, #uploadComprovantePDF {
        display: none;
      }
      .pix-info {
        background-color: #f0f0f0;
        padding: 15px;
        border-radius: 10px;
        margin-top: 15px;
      }
      .pix-info p {
        margin: 5px 0;
      }
      .pix-info strong {
        color: #075E54;
      }
      .comprovante-container {
        margin-top: 15px;
      }
      .comprovante-preview {
        max-width: 100%;
        max-height: 200px;
        border-radius: 8px;
        margin-top: 10px;
        border: 1px solid #ccc;
      }
      .success-message {
        color: #25D366;
        font-weight: bold;
        margin-top: 10px;
      }
      .error-message {
        color: #f44336;
        font-weight: bold;
        margin-top: 10px;
      }
      .pdf-warning {
        background-color: #fff3cd;
        color: #856404;
        padding: 10px;
        border-radius: 5px;
        margin-top: 10px;
        font-size: 14px;
      }
      .upload-buttons {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 10px;
      }
      .whatsapp-input {
        width: 100%;
        padding: 10px;
        border: 1px solid #075E54;
        border-radius: 20px;
        margin-top: 10px;
        font-size: 14px;
      }
      .audio-message {
        display: flex;
        align-items: center;
        background-color: white;
        border-radius: 8px;
        padding: 10px;
        max-width: 200px;
        margin-bottom: 8px;
      }
      .audio-message img {
        width: 24px;
        height: 24px;
        margin-right: 10px;
      }
      .audio-message .audio-info {
        flex: 1;
      }
      .audio-message .audio-title {
        font-size: 14px;
        font-weight: bold;
        margin-bottom: 2px;
      }
      .audio-message .audio-duration {
        font-size: 12px;
        color: #666;
      }
      .audio-message .audio-wave {
        display: flex;
        align-items: center;
        height: 20px;
        margin-top: 4px;
      }
      .audio-message .audio-wave span {
        display: inline-block;
        width: 2px;
        height: 100%;
        background-color: #075E54;
        margin-right: 2px;
        animation: wave 1.5s infinite ease-in-out;
      }
      .audio-message .audio-wave span:nth-child(2) {
        animation-delay: 0.2s;
        height: 80%;
      }
      .audio-message .audio-wave span:nth-child(3) {
        animation-delay: 0.4s;
        height: 60%;
      }
      .audio-message .audio-wave span:nth-child(4) {
        animation-delay: 0.6s;
        height: 80%;
      }
      .audio-message .audio-wave span:nth-child(5) {
        animation-delay: 0.8s;
        height: 100%;
      }
      @keyframes wave {
        0%, 100% { height: 50%; }
        50% { height: 100%; }
      }
    </style>
  </head>
  <body>
    <div class="chat-container">
      <div class="chat-header">
        <img src="perfil.webp" alt="Perfil">
        <div class="name"><strong>Larissa Campos</strong></div>
      </div>
      <div class="chat-body" id="chatBody"></div>
      <div class="chat-footer">
        <input type="text" id="userInput" placeholder="Digite sua mensagem..." oninput="updateActionIcon()" onkeypress="handleKeyPress(event)">
        <button id="actionButton" title="Enviar">
          <img id="actionIcon" src="mensagem.webp" alt="Ãcone">
        </button>
      </div>
    </div>
    <script>
      // ConfiguraÃ§Ã£o do PDF.js
      pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.12.313/pdf.worker.min.js';
      
      const GEMINI_API_KEY = 'AIzaSyBZWq79odwHX5NnccXU_1Y9_SSYAAuPg3Q';
      const GEMINI_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent';
      const PIX_KEY = '98981420070';
      const RECEIVER_NAME = 'Antonio Renimar Pinheiro Almeida';
      const RECEIVER_KEYWORDS = ['antonio', 'renimar', 'pinheiro', 'almeida'];
      const EBOOK_BASICO_LINK = 'https://drive.google.com/drive/folders/1v86_qVHA61RQR8X1gtAv3xaxSxKnwvXb';
      const EBOOK_COMPLETO_LINK = 'https://drive.google.com/drive/folders/1vAot8BBYUrWqPvYeCYUVMcvQxAybNTmF';
      const WHATSAPP_LARISSA = '98981507823';
      const GRUPO_WHATSAPP = 'https://chat.whatsapp.com/HgZNILSst31K2pQSXWiAAp';
      const RECEITA_GRATIS_LINK = 'https://drive.google.com/drive/folders/10dhKX4lN2eTHxDsCWycopeeLFTyYBW5M';
      const APP_SCRIPT_URL = ''; // URL do Google Apps Script serÃ¡ inserida aqui
      
      let isWaitingResponse = false;
      let typingEl = null;
      let conversationStage = 0;
      let currentPackage = 'basico';
      let lastOptionSelected = null;
      let shownBasicoDetails = false;
      let shownCompletoDetails = false;
      let isWaitingPayment = false;
      let uploadedComprovante = null;
      let comprovanteUploaded = false;
      let isWaitingWhatsappNumber = false;

      const actionButton = document.getElementById('actionButton');
      const actionIcon = document.getElementById('actionIcon');
      const userInput = document.getElementById('userInput');

      actionButton.addEventListener('click', () => {
        if (userInput.value.trim()) {
          sendMessage();
        }
      });

      function updateActionIcon() {
        if (userInput.value.trim()) {
          actionIcon.src = 'mensagem.webp';
        } else {
          actionIcon.src = 'mensagem.webp';
        }
      }

      function buildSystemPrompt(userMessage) {
        let prompt = `VocÃª Ã© a Chef Larissa Campos, chef e nutricionista especializada em receitas sem glÃºten e sem lactose. Responda sempre em primeira pessoa do singular (eu), de forma direta, simpÃ¡tica, confiante, acolhedora e com leve carisma. Nunca use cumprimentos como "oi" ou "oi, tudo bem?". Use respostas curtas, claras e completas, sem omitir o essencial. NÃ£o inclua chamadas de aÃ§Ã£o textuais redundantes como "ğŸŒŸ Quero o Pacote Completo" no texto, pois os botÃµes aparecem abaixo. Incentive a compra de forma natural, ex: "Se quiser, posso te enviar o link agora mesmo ğŸ˜Š". 
        
Importante: Eu nÃ£o aceito pagamento parcelado por jÃ¡ ser um valor de baixo custo e promocional. Aceito apenas PIX Ã  vista.

Sobre mim: Sou nutricionista e chef de FlorianÃ³polis (SC). Minha paixÃ£o pela cozinha comeÃ§ou por amor â€” amor pela minha mÃ£e, que tem intolerÃ¢ncia Ã  lactose, e pelo meu irmÃ£o, que Ã© celÃ­aco. Crio receitas sem glÃºten e sem lactose que sejam simples, gostosas e acolhedoras, para ajudar pessoas a redescobrirem o prazer de comer bem.

Use como base todas as informaÃ§Ãµes de receitas, formatos, formas de pagamento, suporte, bÃ´nus, diferenciais etc. abaixo para adaptar respostas, respondendo sem repetiÃ§Ãµes finais redundantes.

1. Receitas: exemplos como PÃ£o de Frigideira, Vapt-Vupt, HambÃºrguer, Vegano, Castanhas, Mandioquinha com Chia, AmÃªndoas, Cenoura, Baguete, Batata Doce de Micro-ondas. Divididas entre e-books, bÃ´nus sÃ³ apÃ³s compra. Todas sem glÃºten e sem lactose. Muitas veganas, substituiÃ§Ãµes ensinadas. BÃ´nus de doces sem aÃ§Ãºcar para diabÃ©ticos no pacote completo. Ingredientes acessÃ­veis. Ebook 50 receitas (~80 pÃ¡gs); Guia 125 receitas (>200 pÃ¡gs). Fotos prontas. Salgadas e doces. RÃ¡pidas (<30 min). Medidas em xÃ­caras e gramas. Substitutos para ovos/alergÃªnicos. BÃ´nus "Bolos Sem GlÃºten" para festas. Algumas opÃ§Ãµes low-carb no completo. FermentaÃ§Ã£o natural em bÃ´nus. Variedade: pÃ£es, bolos, biscoitos, salgados.

2. Qualidade: testadas por mim (chef nutricionista). Garantia de reembolso 7 dias. Depoimentos reais. FormaÃ§Ã£o em NutriÃ§Ã£o. PrÃ©via possÃ­vel via Instagram/WhatsApp.

3. Compra: BÃ¡sico R$9,90, Completo R$19,90. Sem desconto extra. Apenas PIX Ã  vista.

4. Entrega e suporte: acesso em minutos apÃ³s confirmaÃ§Ã£o do pagamento. Envio direto no chat; posso reenviar via WhatsApp. Suporte via WhatsApp comigo; no completo, tambÃ©m comunidade exclusiva.

5. Formato: digital PDF, baixar, imprimir, acessar no celular. AtualizaÃ§Ãµes futuras sem custo. Compartilhamento restrito a uso domÃ©stico.

6. Dificuldade: explicaÃ§Ãµes claras para iniciantes. UtensÃ­lios comuns; algumas receitas usam mixer, mas sempre opÃ§Ãµes simples. RÃ¡pidas e opÃ§Ãµes para airfryer/panela pressÃ£o.

7. BenefÃ­cios: testadas por chef nutricionista, fotos, explicaÃ§Ãµes. Economia de tempo, evita frustraÃ§Ãµes. Dicas e segredos de chef. Suporte confiÃ¡vel.

8. ComparaÃ§Ã£o: BÃ¡sico = 50 receitas, sem comunidade. Completo = 125 receitas + 6 bÃ´nus + comunidade + suporte extra. Suporte diferenciado com comunidade no completo.

9. RestriÃ§Ãµes: opÃ§Ãµes sem ovo, sem soja, substituiÃ§Ãµes para nozes, adaptaÃ§Ãµes FODMAP. AdoÃ§antes naturais.

10. Sobre Larissa: nutricionista formada, chef com ~6 anos. Redes sociais: Instagram @receitinhasdalari, Facebook link fornecido. Objetivo: ajudar a comer bem sem glÃºten/lactose.

11. TÃ©cnicas: uso de goma xantana/psyllium com explicaÃ§Ã£o. Blends de farinhas, tabelas de equivalÃªncia, funÃ§Ã£o de ingredientes.

12. BÃ´nus e promoÃ§Ãµes: pacote completo inclui 6 bÃ´nus. PreÃ§o promocional atual, sem cupons extras. BÃ´nus liberados por tempo limitado.

Regras de botÃµes:
- Interesse claro em "50 Receitas": envie dois botÃµes: "âœ… Comprar 50 Receitas" e "ğŸŒŸ Quero o Pacote Completo".
- Interesse direto no pacote completo: envie apenas "ğŸŒŸ Quero o Pacote Completo".
- NÃ£o envie botÃµes se nÃ£o houver interesse explÃ­cito.
- Se trocar de ideia, ajuste botÃµes conforme novo interesse.
- Use pequena pausa (1-2s) antes de "gravar" ou digitar resposta.
- Nunca envie textos longos: responda curto e objetivo, sem repetiÃ§Ãµes finais.
- Se pergunta sobre qualidade, ingredientes, tempo, dietas, restriÃ§Ãµes, preÃ§os, formatos, bÃ´nus, reembolso, acesso, dÃºvidas tÃ©cnicas: use as respostas acima adaptadas ao tom.
- Se fora do escopo, responda: "Esse assunto foge um pouco do que eu costumo compartilhar por aqui, mas posso te ajudar com receitas incrÃ­veis sem glÃºten e sem lactose! ğŸ’™"

Contexto: ${lastOptionSelected ? 'Ãºltima seleÃ§Ã£o: ' + lastOptionSelected : 'inÃ­cio'}.
Cliente: ${userMessage}
Larissa:`;
        return prompt;
      }

      window.onload = async () => {
        // Fluxo inicial com as novas mensagens
        await simulateTyping("OiÃª! Eu sou a <strong>Larissa Campos</strong>, nutricionista apaixonada por receitas saudÃ¡veis sem glÃºten e sem lactose. ğŸ’›ğŸ¥°");
        await simulateTyping("ğŸ˜± Sofre com glÃºten ou lactose e nada dÃ¡ certo na cozinha? ğŸ Vem comigo! VocÃª vai aprender a fazer pÃ£es incrÃ­veis, com ingredientes simples â€” e muito sabor!");
        await simulateTyping("ğŸ‘‡ Escolhe uma opÃ§Ã£o:");
        appendMessage("bot", `
          <div class="option-buttons">
            <button class="option-button" onclick="handleOptionClick('As 50 Receitas')">ğŸ‘©â€ğŸ³ As 50 Receitas</button>
            <button class="option-button" onclick="handleOptionClick('Me mostra o Pacote Completo')">ğŸ€ Me mostra o Pacote Completo</button>
            <button class="option-button" onclick="handleOptionClick('Grupo GrÃ¡tis no WhatsApp')">ğŸ’š Grupo GrÃ¡tis no WhatsApp</button>
          </div>`);
      };

      async function handleOptionClick(option) {
        appendMessage("user", option);
        lastOptionSelected = option;
        
        if (option === 'As 50 Receitas') {
          currentPackage = 'basico';
          await show50ReceitasFlow();
        } 
        else if (option === 'Me mostra o Pacote Completo') {
          currentPackage = 'completo';
          await showPacoteCompletoFlow();
        }
        else if (option === 'Grupo GrÃ¡tis no WhatsApp') {
          await simulateTyping("Me manda seu nÃºmero de WhatsApp com DDD (exemplo: 11999999999), que eu vou te colocar no nosso Grupo Free do WhasApp com receitinhas, dicas e conteÃºdos exclusivos. Eles sÃ£o animadinhos! ğŸ¤­ğŸ‘‡ğŸ»");
          appendMessage("bot", `<img src="grupo.webp" alt="Grupo WhatsApp" class="preview-image">`);
          await simulateTyping("Se preferir nÃ£o passar agora, tÃ¡ tudo bem! VocÃª pode continuar por aqui mesmo escolhendo uma das opÃ§Ãµes abaixo.");
          
          appendMessage("bot", `
            <div class="option-buttons">
              <button class="option-button" onclick="handleOptionClick('Me mostra o Pacote Completo')">ğŸ€ Me mostra o Pacote Completo</button>
              <button class="option-button" onclick="handleOptionClick('As 50 Receitas')">ğŸ‘©â€ğŸ³ As 50 Receitas</button>
            </div>`);
          
          isWaitingWhatsappNumber = true;
        }
      }

      async function show50ReceitasFlow() {
        await simulateTyping("ğŸ¥° Que bom que vocÃª escolheu comeÃ§ar com as 50 Receitas SaudÃ¡veis!");
        await simulateTyping("Esse e-book estÃ¡ cheio de receitas sem glÃºten e sem lactose â€” fÃ¡ceis e deliciosas!");
        await simulateTyping("<strong>âœ¨ O que vocÃª vai receber:</strong><br><br>ğŸ“˜ 50 receitas exclusivas<br>âŒ Sem glÃºten e sem lactose<br>ğŸ›’ Ingredientes fÃ¡ceis de encontrar<br>ğŸ¤ Suporte direto comigo pelo WhatsApp<br>ğŸ”’ Acesso vitalÃ­cio<br><br><strong>ğŸ”´ Tudo isso por apenas R$ 9,90!</strong>");
        await simulateTyping("ğŸ‘‡ Ã‰ sÃ³ clicar no botÃ£o pra garantir o seu!");
        appendMessage("bot", `
          <div class="option-buttons">
            <button class="option-button" onclick="handleBuyInterest('Garantir as 50 Receitas')">âœ… Garantir as 50 Receitas</button>
            <button class="option-button" onclick="handleOptionClick('Me mostra o Pacote Completo')">ğŸ€ Me mostra o Pacote Completo</button>
            <button class="option-button" onclick="handleOptionClick('Grupo GrÃ¡tis no WhatsApp')">ğŸ’š Grupo GrÃ¡tis no WhatsApp</button>
          </div>`);
      }

      async function showPacoteCompletoFlow() {
        await simulateTyping("ğŸ¥° Claro que sim ğŸ¥°<br>DÃ¡ uma olhadinha no que te espera:");
        await simulateTyping("<strong>ğŸ“š Pacote Completo â€“ R$ 19,90 (promoÃ§Ã£o)</strong><br><br>âœ… Guia PÃ£es Sem GlÃºten â€“ com 125 receitas testadas<br>âœ… Acesso vitalÃ­cio e direito a todas as atualizaÃ§Ãµes futuras<br>âœ… Comunidade exclusiva no WhatsApp<br>âœ… Contato direto comigo via WhatsApp");
        await simulateTyping("<strong>ğŸ 6 E-books Extras:</strong><br><br>ğŸ« Doces sem AÃ§Ãºcar<br><br>ğŸ° Bolos Sem GlÃºten<br><br>ğŸ„ Panetone & Chocotone<br><br>ğŸ¥š SubstituiÃ§Ãµes de Ingredientes<br><br>ğŸ¥– PÃ£es TranÃ§ados<br><br>ğŸ§ª FermentaÃ§Ã£o Natural");
        appendMessage("bot", `
          <div class="option-buttons">
            <button class="option-button" onclick="handleBuyInterest('Quero o Pacote Completo')">ğŸ€ Quero o Pacote Completo</button>
            <button class="option-button" onclick="handleOptionClick('As 50 Receitas')">ğŸ‘©â€ğŸ³ As 50 Receitas</button>
            <button class="option-button" onclick="handleOptionClick('Grupo GrÃ¡tis no WhatsApp')">ğŸ’š Grupo GrÃ¡tis no WhatsApp</button>
          </div>`);
      }

      const personalizedMessages = {
        basico: [
          "ğŸ¥° Que escolha maravilhosa! As 50 receitas vÃ£o transformar sua cozinha!",
          "VocÃª pode pagar via Pix e enviar o comprovante aqui mesmo ğŸ’š",
          "Assim que confirmarmos seu pagamento, seu e-book estarÃ¡ disponÃ­vel para download. â˜ºï¸"
        ],
        completo: [
          "ğŸ¥° Excelente decisÃ£o! O pacote completo vai revolucionar sua alimentaÃ§Ã£o!",
          "VocÃª pode pagar via Pix e enviar o comprovante aqui mesmo ğŸ’š",
          "Assim que confirmarmos seu pagamento, seu acesso serÃ¡ liberado imediatamente. â˜ºï¸"
        ]
      };

      async function handleBuyInterest(option) {
        appendMessage("user", option);
        const lower = option.toLowerCase();
        
        if (lower.includes("garantir as 50 receitas") || lower.includes("quero o bÃ¡sico") || lower.includes("fico com o bÃ¡sico")) {
          currentPackage = 'basico';
          // Mostrar as mensagens personalizadas
          await simulateTyping(personalizedMessages.basico[0]);
          await simulateTyping(personalizedMessages.basico[1]);
          await simulateTyping(personalizedMessages.basico[2]);
          await showPaymentOptions();
        } 
        else if (lower.includes("quero o pacote completo") || lower.includes("quero o completo")) {
          currentPackage = 'completo';
          // Mostrar as mensagens personalizadas
          await simulateTyping(personalizedMessages.completo[0]);
          await simulateTyping(personalizedMessages.completo[1]);
          await simulateTyping(personalizedMessages.completo[2]);
          await showPaymentOptions();
        }
        else if (lower.includes("ver pacote bÃ¡sico") || lower.includes("tenho dÃºvidas") || lower.includes("saber mais sobre as 50 receitas")) {
          currentPackage = 'basico';
          await show50ReceitasFlow();
        }
        else if (lower.includes("ver pacote completo") || lower.includes("detalhes completo") || lower.includes("saber mais sobre o pacote completo")) {
          currentPackage = 'completo';
          await showPacoteCompletoFlow();
        }
        else if (lower.includes("grupo free") || lower.includes("saber mais sobre o grupo")) {
          await handleOptionClick('Grupo GrÃ¡tis no WhatsApp');
        }
        else {
          // Se nÃ£o reconhecer, usa a Gemini para responder
          await handleCustomMessage(option);
        }
      }

      async function showPaymentOptions() {
        isWaitingPayment = true;
        comprovanteUploaded = false;
        
        const price = currentPackage === 'completo' ? '19,90' : '9,90';
        
        const pixInfoHTML = `
          <div class="pix-info">
            <p><strong>ğŸ“Œ Chave Pix (CPF):</strong> ${PIX_KEY}</p>
            <p><strong>ğŸ“Œ Nome:</strong> ${RECEIVER_NAME}</p>
            <p><strong>ğŸŸ¢ Obs.:</strong> O nome que aparece Ã© do responsÃ¡vel pelos pagamentos da minha equipe, tÃ¡ bom? Pode fazer tranquila(o), tÃ¡ tudo certinho!</p>
            <p><strong>ğŸ’° Valor:</strong> R$ ${price}</p>
            <div class="pdf-warning">
              <strong>ğŸ“„ AtenÃ§Ã£o:</strong> VocÃª pode enviar o comprovante em imagem (JPG/PNG) ou em PDF. Assim que for verificado, os produtos serÃ£o liberados automaticamente.
            </div>
          </div>
          <div class="comprovante-container">
            <div class="upload-buttons">
              <label for="uploadComprovanteFoto" class="upload-label">
                <img src="camera.webp" alt="Enviar imagem" />
                Enviar Comprovante em Foto
              </label>
              <label for="uploadComprovantePDF" class="upload-label">
                <img src="pdf-icon.webp" alt="Enviar PDF" />
                Enviar Comprovante em PDF
              </label>
            </div>
            <input type="file" accept="image/*" id="uploadComprovanteFoto" style="display: none" />
            <input type="file" accept=".pdf" id="uploadComprovantePDF" style="display: none" />
          </div>
        `;
        
        appendMessage("bot", pixInfoHTML);
        
        // Configurar os listeners para os uploads
        document.getElementById('uploadComprovanteFoto').addEventListener('change', function(e) {
          if (!comprovanteUploaded) {
            handleComprovanteUpload(e, 'image');
            comprovanteUploaded = true;
          }
        });
        
        document.getElementById('uploadComprovantePDF').addEventListener('change', function(e) {
          if (!comprovanteUploaded) {
            handleComprovanteUpload(e, 'pdf');
            comprovanteUploaded = true;
          }
        });
      }

      async function handleComprovanteUpload(event, type) {
        const file = event.target.files[0];
        if (!file) return;
        
        try {
          if (type === 'pdf') {
            // Processar PDF primeiro para mostrar o comprovante
            await processPDFComprovante(file);
          } else {
            // Processar imagem primeiro para mostrar o comprovante
            await processImageComprovante(file);
          }
          
          // SÃ“ DEPOIS de mostrar o comprovante, exibir a mensagem do bot
          appendMessage("bot", "ğŸ”„ SÃ³ um momentoâ€¦<br>Estou validando seu pagamento. Assim que for confirmado, te libero o acesso! ğŸ˜‰");
          
          showTypingIndicator();
          
          // Agora fazer a validaÃ§Ã£o
          if (type === 'pdf') {
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
            let extractedText = '';
            
            for (let i = 1; i <= pdf.numPages; i++) {
              const page = await pdf.getPage(i);
              const textContent = await page.getTextContent();
              const strings = textContent.items.map(item => item.str);
              extractedText += strings.join(' ') + '\n';
            }
            
            await verifyComprovanteText(extractedText);
          } else {
            const reader = new FileReader();
            const imageData = await new Promise((resolve, reject) => {
              reader.onload = e => resolve(e.target.result);
              reader.onerror = reject;
              reader.readAsDataURL(file);
            });
            await verifyComprovante(imageData);
          }
        } catch (error) {
          console.error("Erro ao processar comprovante:", error);
          hideTypingIndicator();
          showComprovanteError();
        }
      }

      async function processImageComprovante(file) {
        const reader = new FileReader();
        return new Promise((resolve, reject) => {
          reader.onload = function(e) {
            uploadedComprovante = e.target.result;
            const previewHTML = `
              <div class="comprovante-container">
                <p>Comprovante enviado (imagem):</p>
                <img src="${uploadedComprovante}" class="comprovante-preview">
              </div>
            `;
            appendMessage("user", previewHTML);
            resolve();
          };
          reader.onerror = reject;
          reader.readAsDataURL(file);
        });
      }

      async function processPDFComprovante(file) {
        const arrayBuffer = await file.arrayBuffer();
        const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
        
        // Criar uma imagem da primeira pÃ¡gina para mostrar como preview
        const page = await pdf.getPage(1);
        const viewport = page.getViewport({ scale: 1.0 });
        const canvas = document.createElement('canvas');
        const context = canvas.getContext('2d');
        canvas.height = viewport.height;
        canvas.width = viewport.width;
        
        await page.render({
          canvasContext: context,
          viewport: viewport
        }).promise;
        
        const previewImage = canvas.toDataURL('image/jpeg');
        uploadedComprovante = previewImage;
        
        // Mostrar preview do PDF
        const previewHTML = `
          <div class="comprovante-container">
            <p>Comprovante enviado (PDF):</p>
            <img src="${previewImage}" class="comprovante-preview">
          </div>
        `;
        appendMessage("user", previewHTML);
      }

      async function verifyComprovante(imageData) {
        try {
          const expectedAmount = currentPackage === 'completo' ? '19,90' : '9,90';
          
          const { data: { text } } = await Tesseract.recognize(
            imageData,
            'por',
            { logger: m => console.log(m) }
          );
          
          await verifyComprovanteText(text);
        } catch (error) {
          console.error("Erro ao verificar comprovante:", error);
          throw error;
        }
      }

      async function verifyComprovanteText(text) {
        hideTypingIndicator();
        
        const expectedAmount = currentPackage === 'completo' ? '19,90' : '9,90';
        
        // Verificar se o texto contÃ©m qualquer uma das palavras-chave do nome do recebedor e o valor correto
        const normalizedText = text.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '');
        const hasReceiverName = RECEIVER_KEYWORDS.some(keyword => normalizedText.includes(keyword));
        
        const hasCorrectAmount = text.includes(expectedAmount) || 
                               text.includes(expectedAmount.replace(',', '.')) || 
                               text.includes(`R$ ${expectedAmount}`) || 
                               text.includes(`R$${expectedAmount}`);
        
        if (hasReceiverName && hasCorrectAmount) {
          // Mostrar mensagem de sucesso
          const successHTML = `
            <div class="success-message">
              âœ… Pagamento confirmado! Obrigada pela compra!
            </div>
            <p>Seu ${currentPackage === 'completo' ? 'Pacote Completo' : 'E-book com 50 receitas'} jÃ¡ estÃ¡ disponÃ­vel para download.</p>
            <p><strong>Link para download:</strong> <a href="${currentPackage === 'completo' ? EBOOK_COMPLETO_LINK : EBOOK_BASICO_LINK}" target="_blank">Clique aqui para acessar</a></p>
            <p><strong>Meu WhatsApp:</strong> <a href="https://wa.me/${WHATSAPP_LARISSA}" target="_blank">${formatPhoneNumber(WHATSAPP_LARISSA)}</a></p>
            ${currentPackage === 'completo' ? `<p><strong>Grupo exclusivo:</strong> <a href="${GRUPO_WHATSAPP}" target="_blank">Clique para entrar</a></p>` : ''}
            <p>Se precisar de algo, Ã© sÃ³ chamar! ğŸ˜Š</p>
          `;
          appendMessage("bot", successHTML);
          
          // Adicionar o Ã¡udio de agradecimento apÃ³s um pequeno delay
          setTimeout(() => {
            showAudioMessage(currentPackage === 'completo' ? 'agradecimento2.mp3' : 'agradecimento1.mp3');
          }, 2000);
        } else {
          showComprovanteError();
        }
      }

      function showAudioMessage(audioFile) {
        const audioHTML = `
          <div class="audio-message">
            <img src="gravabot.webp" alt="Ãudio">
            <div class="audio-info">
              <div class="audio-title">Ãudio de agradecimento</div>
              <div class="audio-duration">0:10</div>
              <div class="audio-wave">
                <span></span>
                <span></span>
                <span></span>
                <span></span>
                <span></span>
              </div>
            </div>
          </div>
        `;
        
        appendMessage("bot", audioHTML);
        
        // Simular o Ã¡udio sendo reproduzido (na prÃ¡tica, vocÃª implementaria a reproduÃ§Ã£o real aqui)
        setTimeout(() => {
          const audioElement = document.createElement('audio');
          audioElement.src = audioFile;
          audioElement.play().catch(e => console.log("Erro ao reproduzir Ã¡udio:", e));
        }, 1000);
      }

      function showComprovanteError() {
        const expectedAmount = currentPackage === 'completo' ? '19,90' : '9,90';
        
        let errorMessage = '<div class="error-message">âŒ NÃ£o consegui confirmar seu pagamento automaticamente</div>';
        errorMessage += '<p>Por favor, verifique se:</p>';
        errorMessage += '<ul>';
        errorMessage += '<li>VocÃª enviou o comprovante do Pix para a chave <strong>' + PIX_KEY + '</strong> (CPF)</li>';
        errorMessage += '<li>O valor estÃ¡ correto: <strong>R$ ' + expectedAmount + '</strong></li>';
        errorMessage += '</ul>';
        errorMessage += '<p>Se jÃ¡ conferiu tudo e ainda assim nÃ£o foi validado, pode enviar novamente o comprovante?</p>';
        errorMessage += `
          <div class="comprovante-container">
            <div class="upload-buttons">
              <label for="uploadComprovanteFoto" class="upload-label">
                <img src="camera.webp" alt="Enviar imagem" />
                Enviar Comprovante em Foto
              </label>
              <label for="uploadComprovantePDF" class="upload-label">
                <img src="pdf-icon.webp" alt="Enviar PDF" />
                Enviar Comprovante em PDF
              </label>
            </div>
            <input type="file" accept="image/*" id="uploadComprovanteFoto" style="display: none" />
            <input type="file" accept=".pdf" id="uploadComprovantePDF" style="display: none" />
          </div>
        `;
        
        appendMessage("bot", errorMessage);
        
        // Configurar novamente os listeners
        comprovanteUploaded = false;
        document.getElementById('uploadComprovanteFoto').addEventListener('change', function(e) {
          if (!comprovanteUploaded) {
            handleComprovanteUpload(e, 'image');
            comprovanteUploaded = true;
          }
        });
        
        document.getElementById('uploadComprovantePDF').addEventListener('change', function(e) {
          if (!comprovanteUploaded) {
            handleComprovanteUpload(e, 'pdf');
            comprovanteUploaded = true;
          }
        });
      }

      function formatPhoneNumber(phone) {
        return phone.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
      }

      function handleKeyPress(event) {
        if (event.key === 'Enter' && !isWaitingResponse) {
          sendMessage();
        }
      }

      async function sendMessage() {
        if (isWaitingResponse) return;
        const text = userInput.value.trim();
        if (!text) return;
        
        appendMessage("user", text);
        userInput.value = "";
        updateActionIcon();
        isWaitingResponse = true;
        showTypingIndicator();

        const lower = text.toLowerCase();
        const normalized = lower.normalize('NFD').replace(/[\u0300-\u036f]/g, '');

        // Verificar se estÃ¡ esperando nÃºmero do WhatsApp
        if (isWaitingWhatsappNumber) {
          hideTypingIndicator();
          isWaitingWhatsappNumber = false;
          
          // Validar nÃºmero de WhatsApp
          const whatsappNumber = text.replace(/\D/g, ''); // Remove tudo que nÃ£o for dÃ­gito
          
          if (whatsappNumber.length === 11 && 
              whatsappNumber.charAt(2) === '9' && 
              /^\d+$/.test(whatsappNumber)) {
            
            // NÃºmero vÃ¡lido - salvar no Google Sheets via Apps Script
            try {
              if (APP_SCRIPT_URL) {
                await fetch(`${APP_SCRIPT_URL}?whatsapp=${encodeURIComponent(`https://wa.me/${whatsappNumber}`)}`, {
                  method: 'GET'
                });
              }
              
              await simulateTyping("Perfeito! Assim que possÃ­vel, te adiciono no grupo, tÃ¡? ğŸ’šâœ¨");
              
              appendMessage("bot", `
                <div class="option-buttons">
                  <button class="option-button" onclick="handleOptionClick('Me mostra o Pacote Completo')">ğŸ€ Me mostra o Pacote Completo</button>
                  <button class="option-button" onclick="handleOptionClick('As 50 Receitas')">ğŸ‘©â€ğŸ³ As 50 Receitas</button>
                </div>`);
            } catch (error) {
              console.error("Erro ao salvar nÃºmero:", error);
              await simulateTyping("O nÃºmero foi recebido, mas tive um problema tÃ©cnico para registrar. Pode me enviar de novo?");
              isWaitingWhatsappNumber = true;
            }
          } else {
            // NÃºmero invÃ¡lido
            await simulateTyping("Ops! O nÃºmero tÃ¡ com algum errinho... Me envia ele de novo com DDD e tudo junto, assim: 11999999999 ğŸ’¬");
            isWaitingWhatsappNumber = true;
          }
          
          isWaitingResponse = false;
          return;
        }

        // Perguntas sobre Larissa ou sobre o bot
        if (normalized.includes('quem e larissa') || normalized.includes('quem Ã© larissa') ||
            normalized.includes('quem e voce') || normalized.includes('quem Ã© vocÃª') ||
            normalized.includes('quem e vc') || normalized.includes('quem Ã© vc') ||
            (normalized.includes('de onde') && normalized.includes('larissa')) ||
            normalized.includes('onde mora') || normalized.includes('onde vive') ||
            normalized.includes('vc Ã© de onde') || normalized.includes('vocÃª Ã© de onde')) {
          hideTypingIndicator();
          await showLarissaProfile();
          isWaitingResponse = false;
          return;
        }
        // Redes sociais
        if (normalized.includes('instagram') || normalized.includes('facebook') || normalized.includes('rede social') || normalized.includes('seguir')) {
          hideTypingIndicator();
          await simulateTyping("Siga-me:\nhttps://www.instagram.com/receitinhasdalari\nhttps://www.facebook.com/share/1ErC8vLffa/");
          if (currentPackage === 'completo') {
            appendMessage("bot", `
              <div class="option-buttons">
                <button class="option-button" onclick="handleOptionClick('As 50 Receitas')">ğŸ‘©â€ğŸ³ As 50 Receitas</button>
                <button class="option-button" onclick="handleOptionClick('Grupo GrÃ¡tis no WhatsApp')">ğŸ’š Grupo GrÃ¡tis no WhatsApp</button>
              </div>`);
          } else if (currentPackage === 'basico') {
            appendMessage("bot", `
              <div class="option-buttons">
                <button class="option-button" onclick="handleOptionClick('Me mostra o Pacote Completo')">ğŸ€ Me mostra o Pacote Completo</button>
                <button class="option-button" onclick="handleOptionClick('Grupo GrÃ¡tis no WhatsApp')">ğŸ’š Grupo GrÃ¡tis no WhatsApp</button>
              </div>`);
          } else {
            appendMessage("bot", `
              <div class="option-buttons">
                <button class="option-button" onclick="handleOptionClick('As 50 Receitas')">ğŸ‘©â€ğŸ³ As 50 Receitas</button>
                <button class="option-button" onclick="handleOptionClick('Me mostra o Pacote Completo')">ğŸ€ Me mostra o Pacote Completo</button>
                <button class="option-button" onclick="handleOptionClick('Grupo GrÃ¡tis no WhatsApp')">ğŸ’š Grupo GrÃ¡tis no WhatsApp</button>
              </div>`);
          }
          isWaitingResponse = false;
          return;
        }
        // Confiabilidade
        if (isTrustQuestion(text)) {
          hideTypingIndicator();
          await handleTrustQuestion(text);
          isWaitingResponse = false;
          return;
        }
        // Como comprar
        if (normalized.includes('como comprar') || normalized.includes('como faco para comprar') || normalized.includes('como faÃ§o para comprar') || normalized.includes('processo de compra') || normalized.includes('como funciona a compra')) {
          hideTypingIndicator();
          await showHowToBuy();
          isWaitingResponse = false;
          return;
        }
        // Sem glÃºten/lactose
        if (normalized.includes('celiaca') || normalized.includes('celiaco') ||
            (normalized.includes('intolerante') && (normalized.includes('lactose') || normalized.includes('gluten'))) ||
            normalized.includes('sem glÃºten') || normalized.includes('sem gluten') ||
            normalized.includes('sem lactose')) {
          hideTypingIndicator();
          await simulateTyping("Todas as receitas sÃ£o 100% sem glÃºten e sem lactose, adequadas para intolerantes.");
          if (currentPackage === 'completo') {
            appendMessage("bot", `
              <div class="option-buttons">
                <button class="option-button" onclick="handleOptionClick('As 50 Receitas')">ğŸ‘©â€ğŸ³ As 50 Receitas</button>
                <button class="option-button" onclick="handleOptionClick('Grupo GrÃ¡tis no WhatsApp')">ğŸ’š Grupo GrÃ¡tis no WhatsApp</button>
              </div>`);
          } else if (currentPackage === 'basico') {
            appendMessage("bot", `
              <div class="option-buttons">
                <button class="option-button" onclick="handleOptionClick('Me mostra o Pacote Completo')">ğŸ€ Me mostra o Pacote Completo</button>
                <button class="option-button" onclick="handleOptionClick('Grupo GrÃ¡tis no WhatsApp')">ğŸ’š Grupo GrÃ¡tis no WhatsApp</button>
              </div>`);
          } else {
            appendMessage("bot", `
              <div class="option-buttons">
                <button class="option-button" onclick="handleOptionClick('As 50 Receitas')">ğŸ‘©â€ğŸ³ As 50 Receitas</button>
                <button class="option-button" onclick="handleOptionClick('Me mostra o Pacote Completo')">ğŸ€ Me mostra o Pacote Completo</button>
                <button class="option-button" onclick="handleOptionClick('Grupo GrÃ¡tis no WhatsApp')">ğŸ’š Grupo GrÃ¡tis no WhatsApp</button>
              </div>`);
          }
          isWaitingResponse = false;
          return;
        }
        // Pagamento/recebimento
        if ((normalized.includes('recebo') || normalized.includes('receber') || normalized.includes('quando recebo') ||
            normalized.includes('como recebo') || normalized.includes('envio do ebook') ||
            normalized.includes('pagamento') || normalized.includes('cobranca') ||
            normalized.includes('confirmar pagamento') || normalized.includes('recebimento'))) {
          hideTypingIndicator();
          if (currentPackage === 'completo') {
            await simulateTyping("Assim que seu pagamento for confirmado, te envio <strong>tudo aqui no chat</strong> mesmo! VocÃª receberÃ¡:<br>âœ”ï¸ O link para baixar o <strong>Guia Completo com 125 Receitas + 6 BÃ´nus</strong><br>âœ”ï¸ Convite para o <strong>grupo exclusivo</strong> no WhatsApp<br>âœ”ï¸ Meu contato direto para suporte<br><br>Fica tranquilo(a) que eu te guio passo a passo!");
          } else {
            await simulateTyping("Assim que seu pagamento for confirmado, vou te enviar <strong>tudo direto aqui no chat</strong>! VocÃª receberÃ¡:<br>âœ”ï¸ O link para baixar seu <strong>E-book com 50 Receitas</strong> (em PDF)<br>âœ”ï¸ Meu WhatsApp pessoal para tirar dÃºvidas<br><br>Ã‰ super rÃ¡pido! Se o link nÃ£o aparecer em 2 minutinhos, me avisa que eu resolvo. ğŸ’›");
          }
          if (currentPackage === 'completo') {
            appendMessage("bot", `
              <div class="option-buttons">
                <button class="option-button" onclick="handleOptionClick('As 50 Receitas')">ğŸ‘©â€ğŸ³ As 50 Receitas</button>
                <button class="option-button" onclick="handleOptionClick('Grupo GrÃ¡tis no WhatsApp')">ğŸ’š Grupo GrÃ¡tis no WhatsApp</button>
              </div>`);
          } else if (currentPackage === 'basico') {
            appendMessage("bot", `
              <div class="option-buttons">
                <button class="option-button" onclick="handleOptionClick('Me mostra o Pacote Completo')">ğŸ€ Me mostra o Pacote Completo</button>
                <button class="option-button" onclick="handleOptionClick('Grupo GrÃ¡tis no WhatsApp')">ğŸ’š Grupo GrÃ¡tis no WhatsApp</button>
              </div>`);
          } else {
            appendMessage("bot", `
              <div class="option-buttons">
                <button class="option-button" onclick="handleOptionClick('As 50 Receitas')">ğŸ‘©â€ğŸ³ As 50 Receitas</button>
                <button class="option-button" onclick="handleOptionClick('Me mostra o Pacote Completo')">ğŸ€ Me mostra o Pacote Completo</button>
                <button class="option-button" onclick="handleOptionClick('Grupo GrÃ¡tis no WhatsApp')">ğŸ’š Grupo GrÃ¡tis no WhatsApp</button>
              </div>`);
          }
          isWaitingResponse = false;
          return;
        }
        // DiferenÃ§a entre e-books
        if (normalized.includes('diferenca') || normalized.includes('diferenÃ§a') || normalized.includes('comparar') || normalized.includes('oq muda') || normalized.includes('oque muda') || normalized.includes('o que muda')) {
          hideTypingIndicator();
          await simulateTyping("BÃ¡sico: 50 receitas sem glÃºten e lactose, acesso vitalÃ­cio, suporte. R$ 9,90. Completo: 125 receitas, comunidade, contato direto, atualizaÃ§Ãµes e 6 bÃ´nus. R$ 19,90.");
          if (currentPackage === 'completo') {
            appendMessage("bot", `
              <div class="option-buttons">
                <button class="option-button" onclick="handleOptionClick('As 50 Receitas')">ğŸ‘©â€ğŸ³ As 50 Receitas</button>
                <button class="option-button" onclick="handleOptionClick('Grupo GrÃ¡tis no WhatsApp')">ğŸ’š Grupo GrÃ¡tis no WhatsApp</button>
              </div>`);
          } else if (currentPackage === 'basico') {
            appendMessage("bot", `
              <div class="option-buttons">
                <button class="option-button" onclick="handleOptionClick('Me mostra o Pacote Completo')">ğŸ€ Me mostra o Pacote Completo</button>
                <button class="option-button" onclick="handleOptionClick('Grupo GrÃ¡tis no WhatsApp')">ğŸ’š Grupo GrÃ¡tis no WhatsApp</button>
              </div>`);
          } else {
            appendMessage("bot", `
              <div class="option-buttons">
                <button class="option-button" onclick="handleOptionClick('As 50 Receitas')">ğŸ‘©â€ğŸ³ As 50 Receitas</button>
                <button class="option-button" onclick="handleOptionClick('Me mostra o Pacote Completo')">ğŸ€ Me mostra o Pacote Completo</button>
                <button class="option-button" onclick="handleOptionClick('Grupo GrÃ¡tis no WhatsApp')">ğŸ’š Grupo GrÃ¡tis no WhatsApp</button>
              </div>`);
          }
          isWaitingResponse = false;
          return;
        }
        // Comunidade
        if (normalized.includes('comunidade') || normalized.includes('whatsapp') || normalized.includes('grupo') || normalized.includes('contato direto')) {
          hideTypingIndicator();
          await simulateTyping("No Pacote Completo vocÃª tem tanto a comunidade exclusiva quanto contato direto comigo via WhatsApp. Para participar, clique no botÃ£o.");
          appendMessage("bot", `
            <div class="option-buttons">
              <button class="option-button" onclick="handleOptionClick('As 50 Receitas')">ğŸ‘©â€ğŸ³ As 50 Receitas</button>
              <button class="option-button" onclick="handleOptionClick('Grupo GrÃ¡tis no WhatsApp')">ğŸ’š Grupo GrÃ¡tis no WhatsApp</button>
            </div>`);
          isWaitingResponse = false;
          return;
        }
        // Acesso mÃ³vel
        if ((normalized.includes('acessar') && normalized.includes('celular')) || normalized.includes('pelo celular') || normalized.includes('no cel')) {
          hideTypingIndicator();
          await simulateTyping("VocÃª pode acessar tudo pelo celular, tablet ou computador.");
          if (currentPackage) {
            appendMessage("bot", `
              <div class="option-buttons">
                <button class="option-button" onclick="handleOptionClick('As 50 Receitas')">ğŸ‘©â€ğŸ³ As 50 Receitas</button>
                <button class="option-button" onclick="handleOptionClick('Me mostra o Pacote Completo')">ğŸ€ Me mostra o Pacote Completo</button>
                <button class="option-button" onclick="handleOptionClick('Grupo GrÃ¡tis no WhatsApp')">ğŸ’š Grupo GrÃ¡tis no WhatsApp</button>
              </div>`);
          } else {
            appendMessage("bot", `
              <div class="option-buttons">
                <button class="option-button" onclick="handleOptionClick('As 50 Receitas')">ğŸ‘©â€ğŸ³ As 50 Receitas</button>
                <button class="option-button" onclick="handleOptionClick('Me mostra o Pacote Completo')">ğŸ€ Me mostra o Pacote Completo</button>
                <button class="option-button" onclick="handleOptionClick('Grupo GrÃ¡tis no WhatsApp')">ğŸ’š Grupo GrÃ¡tis no WhatsApp</button>
              </div>`);
          }
          isWaitingResponse = false;
          return;
        }
        // Imprimir
        if (normalized.includes('imprimir') || normalized.includes('impressa')) {
          hideTypingIndicator();
          await simulateTyping("Os arquivos sÃ£o PDF e podem ser baixados e impressos.");
          if (currentPackage) {
            appendMessage("bot", `
              <div class="option-buttons">
                <button class="option-button" onclick="handleOptionClick('As 50 Receitas')">ğŸ‘©â€ğŸ³ As 50 Receitas</button>
                <button class="option-button" onclick="handleOptionClick('Me mostra o Pacote Completo')">ğŸ€ Me mostra o Pacote Completo</button>
                <button class="option-button" onclick="handleOptionClick('Grupo GrÃ¡tis no WhatsApp')">ğŸ’š Grupo GrÃ¡tis no WhatsApp</button>
              </div>`);
          } else {
            appendMessage("bot", `
              <div class="option-buttons">
                <button class="option-button" onclick="handleOptionClick('As 50 Receitas')">ğŸ‘©â€ğŸ³ As 50 Receitas</button>
                <button class="option-button" onclick="handleOptionClick('Me mostra o Pacote Completo')">ğŸ€ Me mostra o Pacote Completo</button>
                <button class="option-button" onclick="handleOptionClick('Grupo GrÃ¡tis no WhatsApp')">ğŸ’š Grupo GrÃ¡tis no WhatsApp</button>
              </div>`);
          }
          isWaitingResponse = false;
          return;
        }
        // Formas de pagamento
        if (normalized.includes('pix') || normalized.includes('boleto') || normalized.includes('cartao') || normalized.includes('forma de pagamento') || normalized.includes('parcelado') || normalized.includes('parcelamento')) {
          hideTypingIndicator();
          if (normalized.includes('parcelado') || normalized.includes('parcelamento')) {
            await simulateTyping("Eu nÃ£o aceito pagamento parcelado por jÃ¡ ser um valor de baixo custo e promocional. Aceito apenas PIX Ã  vista.");
          } else {
            await simulateTyping("Aceito apenas PIX Ã  vista. Ã‰ rÃ¡pido, seguro e vocÃª pode pagar direto pelo seu app bancÃ¡rio.");
          }
          if (currentPackage) {
            appendMessage("bot", `
              <div class="option-buttons">
                <button class="option-button" onclick="handleOptionClick('As 50 Receitas')">ğŸ‘©â€ğŸ³ As 50 Receitas</button>
                <button class="option-button" onclick="handleOptionClick('Me mostra o Pacote Completo')">ğŸ€ Me mostra o Pacote Completo</button>
                <button class="option-button" onclick="handleOptionClick('Grupo GrÃ¡tis no WhatsApp')">ğŸ’š Grupo GrÃ¡tis no WhatsApp</button>
              </div>`);
          } else {
            appendMessage("bot", `
              <div class="option-buttons">
                <button class="option-button" onclick="handleOptionClick('As 50 Receitas')">ğŸ‘©â€ğŸ³ As 50 Receitas</button>
                <button class="option-button" onclick="handleOptionClick('Me mostra o Pacote Completo')">ğŸ€ Me mostra o Pacote Completo</button>
                <button class="option-button" onclick="handleOptionClick('Grupo GrÃ¡tis no WhatsApp')">ğŸ’š Grupo GrÃ¡tis no WhatsApp</button>
              </div>`);
          }
          isWaitingResponse = false;
          return;
        }
        // E-books extras do completo
        if ((normalized.includes('6 ebooks') || normalized.includes('6 e-books') || normalized.includes('ebooks extras') || normalized.includes('extras pacote completo')) && normalized.includes('completo')) {
          hideTypingIndicator();
          await simulateTyping("SÃ£o 6 bÃ´nus: doces sem aÃ§Ãºcar, bolos sem glÃºten, panetones & chocotones, fermentaÃ§Ã£o natural, substituiÃ§Ãµes e pÃ£es tranÃ§ados.");
          appendMessage("bot", `
            <div class="option-buttons">
              <button class="option-button" onclick="handleOptionClick('As 50 Receitas')">ğŸ‘©â€ğŸ³ As 50 Receitas</button>
              <button class="option-button" onclick="handleOptionClick('Grupo GrÃ¡tis no WhatsApp')">ğŸ’š Grupo GrÃ¡tis no WhatsApp</button>
            </div>`);
          isWaitingResponse = false;
          return;
        }
        // Suporte tÃ©cnico
        if (normalized.includes('suporte') || normalized.includes('profissional') || normalized.includes('especialista')) {
          hideTypingIndicator();
          await simulateTyping("Suporte via WhatsApp: no BÃ¡sico falo diretamente com vocÃª; no Completo, alÃ©m do contato direto, vocÃª tambÃ©m tem acesso Ã  comunidade exclusiva.");
          if (currentPackage === 'completo') {
            appendMessage("bot", `
              <div class="option-buttons">
                <button class="option-button" onclick="handleOptionClick('As 50 Receitas')">ğŸ‘©â€ğŸ³ As 50 Receitas</button>
                <button class="option-button" onclick="handleOptionClick('Grupo GrÃ¡tis no WhatsApp')">ğŸ’š Grupo GrÃ¡tis no WhatsApp</button>
              </div>`);
          } else {
            appendMessage("bot", `
              <div class="option-buttons">
                <button class="option-button" onclick="handleOptionClick('Me mostra o Pacote Completo')">ğŸ€ Me mostra o Pacote Completo</button>
                <button class="option-button" onclick="handleOptionClick('Grupo GrÃ¡tis no WhatsApp')">ğŸ’š Grupo GrÃ¡tis no WhatsApp</button>
              </div>`);
          }
          isWaitingResponse = false;
          return;
        }
        // ConteÃºdo sem clicar botÃ£o
        if ((normalized.includes('conteudo') || normalized.includes('o que tem') || normalized.includes('quais') || normalized.includes('oq vem') || normalized.includes('oque vem') || normalized.includes('oque tem')) &&
            normalized.includes('pacote completo')) {
          hideTypingIndicator();
          await showPacoteCompletoFlow();
          isWaitingResponse = false;
          return;
        }
        if ((normalized.includes('conteudo') || normalized.includes('o que tem') || normalized.includes('quais') || normalized.includes('oq vem') || normalized.includes('oque vem') || normalized.includes('oque tem')) &&
            (normalized.includes('50 receitas') || normalized.includes('ebook basico') || normalized.includes('basico'))) {
          hideTypingIndicator();
          await show50ReceitasFlow();
          isWaitingResponse = false;
          return;
        }
        // Interesse em ver fotos/exemplos das receitas
        if (normalized.includes('exemplo') || normalized.includes('amostra') || normalized.includes('foto') || 
            normalized.includes('imagem') || normalized.includes('ver como') || normalized.includes('como sÃ£o') ||
            normalized.includes('mostra') || normalized.includes('visualizar') || normalized.includes('visual')) {
          hideTypingIndicator();
          await simulateTyping("Claro! DÃ¡ uma olhadinha nessas delÃ­cias que vocÃª vai aprender a fazer ğŸ˜");
          
          // Mostrar as imagens das receitas
          const imagesHTML = `
            <div style="margin-top: 10px;">
              <img src="pao1.webp" alt="PÃ£o de Milho de Frigideira" class="preview-image">
              <img src="pao2.webp" alt="PÃ£o de Batata na Airfryer" class="preview-image">
              <p>Olha sÃ³ o que os nossos alunos estÃ£o dizendoâ€¦</p>
              <img src="depoimento.webp" alt="Depoimentos" class="testimonial-image">
              <p>VocÃª pode confiar, esse conteÃºdo jÃ¡ transformou a rotina de muita gente.</p>
            </div>
          `;
          appendMessage("bot", imagesHTML);
          
          if (currentPackage === 'completo') {
            appendMessage("bot", `
              <div class="option-buttons">
                <button class="option-button" onclick="handleOptionClick('As 50 Receitas')">ğŸ‘©â€ğŸ³ As 50 Receitas</button>
                <button class="option-button" onclick="handleOptionClick('Grupo GrÃ¡tis no WhatsApp')">ğŸ’š Grupo GrÃ¡tis no WhatsApp</button>
              </div>`);
          } else if (currentPackage === 'basico') {
            appendMessage("bot", `
              <div class="option-buttons">
                <button class="option-button" onclick="handleOptionClick('Me mostra o Pacote Completo')">ğŸ€ Me mostra o Pacote Completo</button>
                <button class="option-button" onclick="handleOptionClick('Grupo GrÃ¡tis no WhatsApp')">ğŸ’š Grupo GrÃ¡tis no WhatsApp</button>
              </div>`);
          } else {
            appendMessage("bot", `
              <div class="option-buttons">
                <button class="option-button" onclick="handleOptionClick('As 50 Receitas')">ğŸ‘©â€ğŸ³ As 50 Receitas</button>
                <button class="option-button" onclick="handleOptionClick('Me mostra o Pacote Completo')">ğŸ€ Me mostra o Pacote Completo</button>
                <button class="option-button" onclick="handleOptionClick('Grupo GrÃ¡tis no WhatsApp')">ğŸ’š Grupo GrÃ¡tis no WhatsApp</button>
              </div>`);
          }
          isWaitingResponse = false;
          return;
        }
        // Interesse direto
        const purchaseIntent = detectPurchaseIntent(text);
        if (purchaseIntent) {
          hideTypingIndicator();
          if (purchaseIntent.package === 'completo') {
            currentPackage = 'completo';
            await simulateTyping(personalizedMessages.completo[0]);
            await simulateTyping(personalizedMessages.completo[1]);
            await simulateTyping(personalizedMessages.completo[2]);
            await showPaymentOptions();
          } else {
            currentPackage = 'basico';
            await simulateTyping(personalizedMessages.basico[0]);
            await simulateTyping(personalizedMessages.basico[1]);
            await simulateTyping(personalizedMessages.basico[2]);
            await showPaymentOptions();
          }
          isWaitingResponse = false;
          return;
        }
        
        // Se nÃ£o for nenhum dos casos acima, usa a Gemini para responder
        hideTypingIndicator();
        await handleCustomMessage(text);
        isWaitingResponse = false;
      }

      function detectPurchaseIntent(message) {
        const lowerMsg = message.toLowerCase();
        if (lowerMsg.includes('quero o pacote completo') || lowerMsg.includes('125 receitas') || lowerMsg.includes('pacote completo') || lowerMsg.includes('vou ficar com o completo')) {
          return { package: 'completo' };
        }
        if (lowerMsg.includes('quero as 50 receitas') || lowerMsg.includes('ebook bÃ¡sico') || lowerMsg.includes('50 receitas') || lowerMsg.includes('bÃ¡sico') || lowerMsg.includes('basico') || lowerMsg.includes('vou ficar com as 50')) {
          return { package: 'basico' };
        }
        if (lowerMsg.includes('quero comprar') || lowerMsg.includes('adquirir') || lowerMsg.includes('garantir') || lowerMsg.includes('vou comprar')) {
          return { package: currentPackage || 'basico' };
        }
        return null;
      }

      function isTrustQuestion(message) {
        const lowerMsg = message.toLowerCase();
        return (
          lowerMsg.includes('confiÃ¡vel') ||
          lowerMsg.includes('confiavel') ||
          lowerMsg.includes('golpe') ||
          lowerMsg.includes('seguro') ||
          lowerMsg.includes('verdade') ||
          lowerMsg.includes('mentira') ||
          lowerMsg.includes('depoimento') ||
          lowerMsg.includes('prova') ||
          lowerMsg.includes('real') ||
          lowerMsg.includes('credibilidade')
        );
      }

      async function handleTrustQuestion(message) {
        await simulateTyping("Pode ficar tranquila! Todos meus materiais sÃ£o digitais e entregues automaticamente apÃ³s a compra.");
        appendMessage("bot", `<img src="depoimento.webp" alt="Depoimentos" class="testimonial-image">`);
        await simulateTyping("Olha sÃ³ o que os nossos alunos estÃ£o dizendoâ€¦ VocÃª pode confiar, esse conteÃºdo jÃ¡ transformou a rotina de muita gente.");
        if (conversationStage >= 1) {
          appendMessage("bot", `
            <div class="option-buttons">
              <button class="option-button" onclick="handleOptionClick('As 50 Receitas')">ğŸ‘©â€ğŸ³ As 50 Receitas</button>
              <button class="option-button" onclick="handleOptionClick('Me mostra o Pacote Completo')">ğŸ€ Me mostra o Pacote Completo</button>
              <button class="option-button" onclick="handleOptionClick('Grupo GrÃ¡tis no WhatsApp')">ğŸ’š Grupo GrÃ¡tis no WhatsApp</button>
            </div>`);
        } else {
          appendMessage("bot", `
            <div class="option-buttons">
              <button class="option-button" onclick="handleOptionClick('As 50 Receitas')">ğŸ‘©â€ğŸ³ As 50 Receitas</button>
              <button class="option-button" onclick="handleOptionClick('Me mostra o Pacote Completo')">ğŸ€ Me mostra o Pacote Completo</button>
              <button class="option-button" onclick="handleOptionClick('Grupo GrÃ¡tis no WhatsApp')">ğŸ’š Grupo GrÃ¡tis no WhatsApp</button>
            </div>`);
        }
      }

      async function showLarissaProfile() {
        const profileHTML = `
          <img src="larissa.webp" alt="Larissa Campos" class="profile-image">
          <p>Eu sou a Larissa Campos, nutricionista e chef de FlorianÃ³polis (SC). Minha paixÃ£o pela cozinha comeÃ§ou por amor â€” amor pela minha mÃ£e, que tem intolerÃ¢ncia Ã  lactose, e pelo meu irmÃ£o, que Ã© celÃ­aco.</p>
          <p>Crio receitas sem glÃºten e sem lactose que sejam simples, gostosas e acolhedoras, para ajudar pessoas a redescobrirem o prazer de comer bem.</p>
        `;
        await simulateTyping(profileHTML);
        if (conversationStage === 0) {
          appendMessage("bot", `
            <div class="option-buttons">
              <button class="option-button" onclick="handleOptionClick('As 50 Receitas')">ğŸ‘©â€ğŸ³ As 50 Receitas</button>
              <button class="option-button" onclick="handleOptionClick('Me mostra o Pacote Completo')">ğŸ€ Me mostra o Pacote Completo</button>
              <button class="option-button" onclick="handleOptionClick('Grupo GrÃ¡tis no WhatsApp')">ğŸ’š Grupo GrÃ¡tis no WhatsApp</button>
            </div>`);
        }
      }

      async function showHowToBuy() {
        await simulateTyping("<p>A compra Ã© bem simples e segura:</p><p>1. Escolha o e-book que deseja</p><p>2. FaÃ§a o pagamento via PIX para a chave <strong>98981420070</strong> (CPF)</p><p>3. Envie o comprovante aqui no chat</p><p>4. ApÃ³s confirmaÃ§Ã£o, vocÃª recebe acesso imediato ao material.</p><p>5. Se nÃ£o receber, verifique sua caixa de spam ou me avise.</p>");
        if (currentPackage) {
          appendMessage("bot", `
            <div class="option-buttons">
              <button class="option-button" onclick="handleOptionClick('As 50 Receitas')">ğŸ‘©â€ğŸ³ As 50 Receitas</button>
              <button class="option-button" onclick="handleOptionClick('Me mostra o Pacote Completo')">ğŸ€ Me mostra o Pacote Completo</button>
              <button class="option-button" onclick="handleOptionClick('Grupo GrÃ¡tis no WhatsApp')">ğŸ’š Grupo GrÃ¡tis no WhatsApp</button>
            </div>`);
        } else {
          appendMessage("bot", `
            <div class="option-buttons">
              <button class="option-button" onclick="handleOptionClick('As 50 Receitas')">ğŸ‘©â€ğŸ³ As 50 Receitas</button>
              <button class="option-button" onclick="handleOptionClick('Me mostra o Pacote Completo')">ğŸ€ Me mostra o Pacote Completo</button>
              <button class="option-button" onclick="handleOptionClick('Grupo GrÃ¡tis no WhatsApp')">ğŸ’š Grupo GrÃ¡tis no WhatsApp</button>
            </div>`);
        }
      }

      function showTypingIndicator() {
        if (!typingEl) {
          typingEl = document.createElement("div");
          typingEl.className = "typing-indicator";
          typingEl.innerHTML = "<span></span><span></span><span></span>";
          document.getElementById("chatBody").appendChild(typingEl);
          document.getElementById("chatBody").scrollTop = document.getElementById("chatBody").scrollHeight;
        }
      }

      function hideTypingIndicator() {
        if (typingEl) {
          typingEl.remove();
          typingEl = null;
        }
      }

      async function simulateTyping(message, delay = 1500) {
        // Calcular tempo de digitaÃ§Ã£o baseado no tamanho da mensagem
        const typingTime = Math.min(Math.max(message.length * 30, 1500), 5000);
        showTypingIndicator();
        await new Promise(r => setTimeout(r, typingTime));
        hideTypingIndicator();
        if (message) {
          appendMessage("bot", message);
        }
      }

      function appendMessage(sender, message) {
        const chatBody = document.getElementById("chatBody");
        const msgEl = document.createElement("div");
        msgEl.className = `message ${sender}`;
        msgEl.innerHTML = message;
        chatBody.appendChild(msgEl);
        chatBody.scrollTop = chatBody.scrollHeight;
      }
    </script>
  </body>
</html>
