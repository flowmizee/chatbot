<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
    <title>Chat Web Estilo WhatsApp</title>
    <style>
      html, body {
        margin: 0;
        padding: 0;
        font-family: 'Segoe UI', sans-serif;
        height: 100%;
        background-color: #ece5dd;
      }
      body {
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .chat-container {
        width: 100%;
        height: 100dvh;
        max-width: 430px;
        background-color: #fff;
        display: flex;
        flex-direction: column;
        box-shadow: 0 0 10px rgba(0,0,0,0.2);
        position: relative;
      }
      .chat-header {
        background-color: #075E54;
        padding: 10px 15px;
        display: flex;
        align-items: center;
        color: white;
      }
      .chat-header img {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        margin-right: 12px;
        object-fit: cover;
      }
      .chat-header .name {
        font-size: 18px;
        font-weight: bold;
      }
      .chat-body {
        flex: 1;
        padding: 15px;
        overflow-y: auto;
        background-color: #e5ddd5;
        display: flex;
        flex-direction: column;
      }
      .message {
        max-width: 75%;
        padding: 10px 14px;
        margin-bottom: 8px;
        font-size: 15px;
        border-radius: 8px;
        line-height: 1.4;
        word-wrap: break-word;
      }
      .user {
        align-self: flex-end;
        background-color: #dcf8c6;
        border-bottom-right-radius: 0;
      }
      .bot {
        align-self: flex-start;
        background-color: white;
        border-bottom-left-radius: 0;
      }
      .typing-indicator {
        align-self: flex-start;
        background-color: white;
        border-bottom-left-radius: 0;
        max-width: 50px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 8px;
        margin-bottom: 8px;
        padding: 5px 10px;
      }
      .typing-indicator span {
        display: inline-block;
        width: 6px;
        height: 6px;
        margin: 0 1px;
        background-color: #999;
        border-radius: 50%;
        animation: blink 1.4s infinite both;
      }
      .typing-indicator span:nth-child(2) {
        animation-delay: 0.2s;
      }
      .typing-indicator span:nth-child(3) {
        animation-delay: 0.4s;
      }
      @keyframes blink {
        0%, 80%, 100% { opacity: 0; }
        40% { opacity: 1; }
      }
      .chat-footer {
        display: flex;
        padding: 8px 10px;
        background-color: #fff;
        border-top: 1px solid #ccc;
        align-items: center;
        position: relative;
      }
      .chat-footer input {
        flex: 1;
        padding: 12px;
        border: none;
        font-size: 16px;
        border-radius: 20px;
        margin-right: 8px;
        background-color: #f0f0f0;
        outline: none;
        padding-left: 40px;
      }
      .chat-footer button#actionButton {
        width: 40px;
        height: 40px;
        background-color: #1bac5f;
        border: none;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
      }
      .chat-footer button#actionButton img {
        width: 20px;
        height: 20px;
      }
      .option-buttons {
        display: flex;
        gap: 10px;
        margin-top: 10px;
        flex-wrap: wrap;
      }
      .option-button {
        background-color: #075E54;
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 20px;
        cursor: pointer;
        font-size: 14px;
      }
      .option-button:hover {
        background-color: #0b7a67;
      }
      .preview-image {
        max-width: 100%;
        border-radius: 8px;
        margin-top: 10px;
      }
      .buy-button {
        background-color: #25D366;
        color: white;
        border: none;
        padding: 12px 20px;
        border-radius: 20px;
        cursor: pointer;
        font-size: 16px;
        font-weight: bold;
        margin-top: 15px;
        display: inline-block;
        width: 100%;
        text-align: center;
      }
      .buy-button:hover {
        background-color: #128C7E;
      }
      .testimonial-image {
        max-width: 100%;
        border-radius: 8px;
        margin-top: 10px;
        border: 2px solid #075E54;
      }
      .profile-image {
        max-width: 200px;
        border-radius: 8px;
        margin-top: 10px;
        border: 2px solid #075E54;
      }
      .audio-message {
        display: flex;
        align-items: center;
        background-color: white;
        padding: 10px 15px;
        border-radius: 15px;
        margin-bottom: 8px;
        max-width: 300px;
        width: 250px;
      }
      .audio-message .play-button {
        width: 30px;
        height: 30px;
        background-color: #25D366;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        margin-right: 10px;
        cursor: pointer;
      }
      .audio-message .play-button.playing {
        background-color: #f44336;
      }
      .audio-message .play-button::after {
        content: '';
        width: 0;
        height: 0;
        border-top: 7px solid transparent;
        border-left: 12px solid white;
        border-bottom: 7px solid transparent;
        margin-left: 2px;
      }
      .audio-message .play-button.playing::after {
        content: '';
        width: 10px;
        height: 10px;
        background-color: white;
        border: none;
      }
      .audio-message .audio-info {
        flex: 1;
      }
      .audio-message .audio-wave {
        display: flex;
        align-items: center;
        height: 30px;
        width: 100%;
      }
      .audio-message .audio-wave span {
        display: inline-block;
        width: 2px;
        margin-right: 1px;
        background-color: #075E54;
        border-radius: 2px;
      }
      /* Indicador de grava√ß√£o do bot */
      .bot-recording-indicator {
        background-color: white;
        padding: 8px 12px;
        border-radius: 8px;
        margin-bottom: 8px;
        align-self: flex-start;
        max-width: 40px;
        position: relative;
        box-shadow: 0 1px 1px rgba(0,0,0,0.1);
      }
      .bot-recording-indicator::after {
        content: '';
        position: absolute;
        left: -8px;
        top: 8px;
        width: 0;
        height: 0;
        border-top: 8px solid transparent;
        border-right: 8px solid white;
        border-bottom: 8px solid transparent;
      }
      .bot-recording-img {
        width: 32px;
        height: 32px;
        animation: pulse 1.5s infinite ease-in-out;
      }
      /* Indicador de grava√ß√£o do usu√°rio */
      .user-recording-indicator {
        position: absolute;
        left: 35px;
        display: flex;
        align-items: center;
      }
      .user-recording-img {
        width: 24px;
        height: 24px;
        margin-right: 8px;
        animation: pulse 1.5s infinite ease-in-out;
      }
      .user-recording-time {
        font-size: 14px;
        color: #555;
        position: absolute;
        left: 35px;
        top: 50%;
        transform: translateY(-50%);
        pointer-events: none;
      }
      @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.3; }
      }
      .buy-options {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-top: 15px;
      }
      .mic-icon {
        position: absolute;
        left: 15px;
        width: 24px;
        height: 24px;
        cursor: pointer;
        animation: pulse 1.5s infinite ease-in-out;
        display: none;
        top: 50%;
        transform: translateY(-50%);
        pointer-events: none;
      }
    </style>
  </head>
  <body>
    <div class="chat-container">
      <div class="chat-header">
        <img src="perfil.webp" alt="Perfil">
        <div class="name">Chef Larissa Campos</div>
      </div>
      <div class="chat-body" id="chatBody"></div>
      <div class="chat-footer">
        <img src="gravaperson.webp" alt="Gravar" class="mic-icon" id="micIcon">
        <span class="user-recording-time" id="recordingTime" style="display: none;">0:00</span>
        <input type="text" id="userInput" placeholder="Digite sua mensagem..." oninput="updateActionIcon()" onkeypress="handleKeyPress(event)">
        <button id="actionButton" title="Gravar ou enviar">
          <img id="actionIcon" src="gravacao.webp" alt="√çcone">
        </button>
      </div>
    </div>
    <script>
      const GEMINI_API_KEY = 'AIzaSyBZWq79odwHX5NnccXU_1Y9_SSYAAuPg3Q';
      const GEMINI_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent';
      const CHECKOUT_BASICO = 'https://pay.kiwify.com.br/N7XBarb';
      const CHECKOUT_COMPLETO = 'https://pay.kiwify.com.br/6LNnHnj';
      let isWaitingResponse = false;
      let typingEl = null;
      let conversationStage = 0;
      let currentPackage = 'basico';
      let activeAudio = null;
      let audioEndListener = null;
      let lastOptionSelected = null;
      let shownBasicoDetails = false;
      let shownCompletoDetails = false;
      let recordingStartTime = null;
      let recordingTimer = null;

      const audioPrevia = new Audio('previa.mp3');
      const audioGuia = new Audio('guia.mp3');
      const audioVoice1 = new Audio('voice1.mp3');

      [audioPrevia, audioGuia, audioVoice1].forEach(audio => {
        audio.addEventListener('play', function() {
          if (activeAudio && activeAudio !== this) {
            activeAudio.pause();
            const playButtons = document.querySelectorAll('.play-button');
            playButtons.forEach(btn => btn.classList.remove('playing'));
          }
          activeAudio = this;
          const playButton = document.querySelector(`audio[src="${this.src}"]`)?.parentElement.querySelector('.play-button');
          if (playButton) playButton.classList.add('playing');
        });
        audio.addEventListener('ended', function() {
          const playButton = document.querySelector(`audio[src="${this.src}"]`)?.parentElement.querySelector('.play-button');
          if (playButton) playButton.classList.remove('playing');
          if (audioEndListener) { audioEndListener(); audioEndListener = null; }
        });
      });

      // Web Speech API para grava√ß√£o de voz e transcri√ß√£o
      let recognition;
      const actionButton = document.getElementById('actionButton');
      const actionIcon = document.getElementById('actionIcon');
      const userInput = document.getElementById('userInput');
      const micIcon = document.getElementById('micIcon');
      const recordingTime = document.getElementById('recordingTime');

      if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        recognition = new SpeechRecognition();
        recognition.lang = 'pt-BR';
        recognition.continuous = false;
        recognition.interimResults = false;
        recognition.onstart = () => {
          startRecordingUI();
          recordingStartTime = new Date();
          updateRecordingTime();
        };
        recognition.onend = () => {
          stopRecordingUI();
          if (recordingTimer) {
            clearInterval(recordingTimer);
            recordingTimer = null;
          }
        };
        recognition.onresult = (event) => {
          const transcript = event.results[0][0].transcript;
          userInput.value = transcript;
          updateActionIcon();
          sendMessage();
        };
      }

      function startRecordingUI() {
        micIcon.style.display = 'block';
        recordingTime.style.display = 'block';
        userInput.placeholder = '';
      }

      function stopRecordingUI() {
        micIcon.style.display = 'none';
        recordingTime.style.display = 'none';
        userInput.placeholder = 'Digite sua mensagem...';
      }

      function updateRecordingTime() {
        recordingTimer = setInterval(() => {
          const now = new Date();
          const elapsed = Math.floor((now - recordingStartTime) / 1000);
          const minutes = Math.floor(elapsed / 60);
          const seconds = elapsed % 60;
          recordingTime.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }, 1000);
      }

      actionButton.addEventListener('click', () => {
        if (userInput.value.trim()) {
          sendMessage();
        } else if (recognition) {
          try {
            recognition.start();
          } catch (e) {}
        }
      });

      function updateActionIcon() {
        if (userInput.value.trim()) {
          actionIcon.src = 'mensagem.webp';
        } else {
          actionIcon.src = 'gravacao.webp';
        }
      }

      function buildSystemPrompt(userMessage) {
        let prompt = `Voc√™ √© a Chef Larissa Campos, chef e nutricionista especializada em receitas sem gl√∫ten e sem lactose. Responda sempre em primeira pessoa do singular (eu), de forma direta, simp√°tica, confiante, acolhedora e com leve carisma. Nunca use cumprimentos como "oi" ou "oi, tudo bem?". Use respostas curtas, claras e completas, sem omitir o essencial. N√£o inclua chamadas de a√ß√£o textuais redundantes como "üåü Quero o Pacote Completo" no texto, pois os bot√µes aparecem abaixo. Incentive a compra de forma natural, ex: "Se quiser, posso te enviar o link agora mesmo üòä". 
        
Importante: Eu n√£o aceito pagamento parcelado por j√° ser um valor de baixo custo e promocional. Aceito apenas Cart√£o (√† vista), Pix e boleto.

Sobre mim: Sou nutricionista e chef de Florian√≥polis (SC). Minha paix√£o pela cozinha come√ßou por amor ‚Äî amor pela minha m√£e, que tem intoler√¢ncia √† lactose, e pelo meu irm√£o, que √© cel√≠aco. Crio receitas sem gl√∫ten e sem lactose que sejam simples, gostosas e acolhedoras, para ajudar pessoas a redescobrirem o prazer de comer bem.

Use como base todas as informa√ß√µes de receitas, formatos, formas de pagamento, suporte, b√¥nus, diferenciais etc. abaixo para adaptar respostas, respondendo sem repeti√ß√µes finais redundantes.

1. Receitas: exemplos como P√£o de Frigideira, Vapt-Vupt, Hamb√∫rguer, Vegano, Castanhas, Mandioquinha com Chia, Am√™ndoas, Cenoura, Baguete, Batata Doce de Micro-ondas. Divididas entre e-books, b√¥nus s√≥ ap√≥s compra. Todas sem gl√∫ten e sem lactose. Muitas veganas, substitui√ß√µes ensinadas. B√¥nus de doces sem a√ß√∫car para diab√©ticos no pacote completo. Ingredientes acess√≠veis. Ebook 50 receitas (~80 p√°gs); Guia 125 receitas (>200 p√°gs). Fotos prontas. Salgadas e doces. R√°pidas (<30 min). Medidas em x√≠caras e gramas. Substitutos para ovos/alerg√™nicos. B√¥nus "Bolos Sem Gl√∫ten" para festas. Algumas op√ß√µes low-carb no completo. Fermenta√ß√£o natural em b√¥nus. Variedade: p√£es, bolos, biscoitos, salgados.

2. Qualidade: testadas por mim (chef nutricionista). Garantia de reembolso 7 dias. Depoimentos reais. Plataforma Kiwify segura. Forma√ß√£o em Nutri√ß√£o. Pr√©via poss√≠vel via Instagram/WhatsApp.

3. Compra: B√°sico R$9,90, Completo R$19,90. Sem desconto extra. Pix, boleto, cart√£o (somente √† vista). Valor √† vista. Digital sem taxa. Processado pela Kiwify. Fluxo: clicar bot√£o > Kiwify > preencher > confirma√ß√£o > envio por e-mail.

4. Entrega e suporte: acesso em minutos ap√≥s confirma√ß√£o. Envio por e-mail; posso reenviar via WhatsApp. Suporte via WhatsApp comigo; no completo, tamb√©m comunidade exclusiva.

5. Formato: digital PDF, baixar, imprimir, acessar no celular. Atualiza√ß√µes futuras sem custo. Compartilhamento restrito a uso dom√©stico.

6. Dificuldade: explica√ß√µes claras para iniciantes. Utens√≠lios comuns; algumas receitas usam mixer, mas sempre op√ß√µes simples. R√°pidas e op√ß√µes para airfryer/panela press√£o.

7. Benef√≠cios: testadas por chef nutricionista, fotos, explica√ß√µes. Economia de tempo, evita frustra√ß√µes. Dicas e segredos de chef. Suporte confi√°vel.

8. Compara√ß√£o: B√°sico = 50 receitas, sem comunidade. Completo = 125 receitas + 6 b√¥nus + comunidade + suporte extra. Pode atualizar do b√°sico. Suporte diferenciado com comunidade no completo.

9. Restri√ß√µes: op√ß√µes sem ovo, sem soja, substitui√ß√µes para nozes, adapta√ß√µes FODMAP. Ado√ßantes naturais.

10. Sobre Larissa: nutricionista formada, chef com ~6 anos. Redes sociais: Instagram @receitinhasdalari, Facebook link fornecido. Objetivo: ajudar a comer bem sem gl√∫ten/lactose.

11. T√©cnicas: uso de goma xantana/psyllium com explica√ß√£o. Blends de farinhas, tabelas de equival√™ncia, fun√ß√£o de ingredientes.

12. B√¥nus e promo√ß√µes: pacote completo inclui 6 b√¥nus. Pre√ßo promocional atual, sem cupons extras. B√¥nus liberados por tempo limitado.

Regras de bot√µes:
- Interesse claro em "50 Receitas": envie dois bot√µes: "‚úÖ Comprar 50 Receitas" e "üåü Quero o Pacote Completo".
- Interesse direto no pacote completo: envie apenas "üåü Quero o Pacote Completo".
- N√£o envie bot√µes se n√£o houver interesse expl√≠cito.
- Se trocar de ideia, ajuste bot√µes conforme novo interesse.
- Use pequena pausa (1-2s) antes de "gravar" ou digitar resposta.
- Nunca envie textos longos: responda curto e objetivo, sem repeti√ß√µes finais.
- Se pergunta sobre qualidade, ingredientes, tempo, dietas, restri√ß√µes, pre√ßos, formatos, b√¥nus, reembolso, acesso, d√∫vidas t√©cnicas: use as respostas acima adaptadas ao tom.
- Se fora do escopo, responda: "Esse assunto foge um pouco do que eu costumo compartilhar por aqui, mas posso te ajudar com receitas incr√≠veis sem gl√∫ten e sem lactose! üíô"

Contexto: ${lastOptionSelected ? '√∫ltima sele√ß√£o: ' + lastOptionSelected : 'in√≠cio'}.
Cliente: ${userMessage}
Larissa:`;
        return prompt;
      }

      window.onload = async () => {
        // Fluxo inicial com as mensagens pr√©-definidas intactas
        await simulateTyping("üë©‚Äçüç≥ <strong>Chef Larissa Campos:</strong><br>Ol√° tudo bem? Eu me chomo Larissa Campos, fico feliz que esteja interessada nas minhas Receitinhas saud√°veis.");
        await simulateTyping("üçûVoc√™ est√° diante da oportunidade de aprender a fazer receitas sem gl√∫ten incr√≠veis, fofinhos e deliciosos, que v√£o surpreender todo mundo!<br><br>- 50 receitas exclusivas<br>- Sem Gl√∫ten e Sem Lactose<br>- Ingredientes de f√°cil acesso<br>- ‚Å†Suporte no Whatsapp<br>- Acesso Vital√≠cio<br><br>üî¥Tudo isso por apenas <strong>R$ 9,90</strong>!");
        // Mostrar indicador de grava√ß√£o do bot como mensagem
        const recordingEl = document.createElement("div");
        recordingEl.className = "bot-recording-indicator";
        recordingEl.innerHTML = `<img src="gravabot.webp" class="bot-recording-img">`;
        document.getElementById("chatBody").appendChild(recordingEl);
        document.getElementById("chatBody").scrollTop = document.getElementById("chatBody").scrollHeight;
        await new Promise(r => setTimeout(r, 3000));
        recordingEl.remove();
        await showAudioMessage(audioVoice1, false);
        await waitForAudioToFinish(audioVoice1);
        appendMessage("bot", `
          <p>Qual voc√™ quer? üëáüèª‚ò∫Ô∏è</p>
          <div class="option-buttons">
            <button class="option-button" onclick="handleOptionClick('Pacote Completo')">Pacote Completo ü•π</button>
            <button class="option-button" onclick="handleOptionClick('As 50 Receitas')">As 50 Receitas ‚ù§Ô∏è</button>
          </div>`);
      };

      function waitForAudioToFinish(audio) {
        return new Promise(resolve => {
          if (audio.duration > 0 && !audio.paused) {
            audioEndListener = resolve;
          } else {
            setTimeout(resolve, 2000);
          }
        });
      }

      async function handleOptionClick(option) {
        appendMessage("user", option);
        lastOptionSelected = option;
        currentPackage = option.toLowerCase().includes('completo') ? 'completo' : 'basico';
        // indicador de grava√ß√£o bot como mensagem
        const recEl = document.createElement("div");
        recEl.className = "bot-recording-indicator";
        recEl.innerHTML = `<img src="gravabot.webp" class="bot-recording-img">`;
        document.getElementById("chatBody").appendChild(recEl);
        document.getElementById("chatBody").scrollTop = document.getElementById("chatBody").scrollHeight;
        await new Promise(r => setTimeout(r, Math.random() * 2000 + 2000));
        recEl.remove();
        if (currentPackage === 'completo') {
          shownCompletoDetails = true;
          await showAudioMessage(audioGuia, false);
          await waitForAudioToFinish(audioGuia);
          await showPackageDetailsAndAsk();
        } else {
          shownBasicoDetails = true;
          await showAudioMessage(audioPrevia, false);
          await waitForAudioToFinish(audioPrevia);
          await showPreviewAndAsk();
        }
      }

      async function showAudioMessage(audio, autoplay = false) {
        const audioMessageHTML = `
          <div class="audio-message">
            <div class="play-button" onclick="toggleAudio(this)"></div>
            <div class="audio-info">
              <div class="audio-wave">
                ${Array.from({length: 50}, () =>
                  `<span style="height:${Math.random() * 20 + 5}px"></span>`
                ).join('')}
              </div>
            </div>
            <audio src="${audio.src}" style="display:none"></audio>
          </div>
        `;
        appendMessage("bot", audioMessageHTML);
        if (autoplay) {
          const audioElement = document.querySelector(`audio[src="${audio.src}"]`);
          if (audioElement) {
            audioElement.play().catch(e => console.log("Auto-play n√£o permitido:", e));
          }
        }
      }

      function toggleAudio(button) {
        const audio = button.parentElement.querySelector('audio');
        if (audio.paused) {
          audio.play();
          button.classList.add('playing');
          audioEndListener = () => {
            showTypingIndicator();
            setTimeout(hideTypingIndicator, 1500);
          };
        } else {
          audio.pause();
          button.classList.remove('playing');
          audioEndListener = null;
        }
      }

      async function showPackageDetailsAndAsk() {
        conversationStage = 1;
        const detailsHTML = `
          <div style="margin-top: 10px;">
            <p>üìö <strong>Pacote Completo - Tudo o que voc√™ vai receber:</strong></p>
            <p>‚úÖ Guia P√£es Sem Gl√∫ten com 125 receitas</p>
            <p>‚úÖ Acesso vital√≠cio e todas as atualiza√ß√µes</p>
            <p>‚úÖ Comunidade exclusiva no WhatsApp</p>
            <p>‚úÖ Contato direto comigo via WhatsApp</p>
            <p>‚úÖ 6 E-books extras:</p>
            <p>‚Ä¢ Doces sem A√ß√∫car</p>
            <p>‚Ä¢ Bolos Sem Gl√∫ten</p>
            <p>‚Ä¢ Panetone &amp; Chocotone</p>
            <p>‚Ä¢ Substitui√ß√µes de Ingredientes</p>
            <p>‚Ä¢ P√£es Tran√ßados</p>
            <p>‚Ä¢ Fermenta√ß√£o Natural</p>
            <p>üî¥ Investimento: <strong>R$ 19,90</strong> (valor promocional)</p>
          </div>
        `;
        await simulateTyping(detailsHTML);
        await simulateTyping("O que achou? Quer garantir seu acesso?");
        appendMessage("bot", `
          <div class="option-buttons">
            <button class="option-button" onclick="handleBuyInterest('Quero o Pacote Completo')">Quero o Completo üåü</button>
            <button class="option-button" onclick="handleBuyInterest('Ver Pacote B√°sico')">Ver Pacote B√°sico</button>
          </div>`);
      }

      async function showPreviewAndAsk() {
        conversationStage = 1;
        const imagesHTML = `
          <div style="margin-top: 10px;">
            <img src="receita1.webp" alt="Receita 1" class="preview-image">
            <img src="receita2.webp" alt="Receita 2" class="preview-image">
            <p>üòç Impressionante, n√©? S√£o 50 receitas incr√≠veis!</p>
            <p>üî¥ Investimento: <strong>R$ 9,90</strong> (valor promocional)</p>
          </div>
        `;
        await simulateTyping(imagesHTML);
        await simulateTyping("O que voc√™ achou? Posso te mostrar como adquirir?");
        appendMessage("bot", `
          <div class="option-buttons">
            <button class="option-button" onclick="handleBuyInterest('Sim, quero comprar')">Sim, quero comprar</button>
            <button class="option-button" onclick="handleBuyInterest('Mais informa√ß√µes')">Mais informa√ß√µes</button>
          </div>`);
      }

      const personalizedMessages = [
        "√ìtima escolha! Voc√™ vai amar o conte√∫do e as receitas v√£o transformar sua cozinha.",
        "Excelente decis√£o! Prepare-se para receber receitas incr√≠veis e saud√°veis.",
        "Voc√™ fez uma escolha maravilhosa! Em breve, seu e-book estar√° a caminho.",
        "Que bom que escolheu este pacote! Tenho certeza de que vai adorar cada receita.",
        "Perfeito! Seu investimento em receitas saud√°veis vai valer cada centavo."
      ];

      function getRandomPersonalized() {
        return personalizedMessages[Math.floor(Math.random() * personalizedMessages.length)];
      }

      async function handleBuyInterest(option) {
        appendMessage("user", option);
        const lower = option.toLowerCase();
        if (lower.includes("ver pacote b√°sico")) {
          currentPackage = 'basico';
          shownBasicoDetails = true;
          await simulateTyping("Claro! Vou mostrar mais sobre o Ebook B√°sico.");
          // bot grava√ß√£o indicador como mensagem
          const recEl = document.createElement("div");
          recEl.className = "bot-recording-indicator";
          recEl.innerHTML = `<img src="gravabot.webp" class="bot-recording-img">`;
          document.getElementById("chatBody").appendChild(recEl);
          document.getElementById("chatBody").scrollTop = document.getElementById("chatBody").scrollHeight;
          await waitForAudioToFinish(audioPrevia);
          recEl.remove();
          await showAudioMessage(audioPrevia, false);
          await waitForAudioToFinish(audioPrevia);
          const imagesHTML = `
            <div style="margin-top: 10px;">
              <img src="receita1.webp" alt="Receita 1" class="preview-image">
              <img src="receita2.webp" alt="Receita 2" class="preview-image">
              <p>üòç Impressionante, n√©? S√£o 50 receitas incr√≠veis!</p>
              <p>üî¥ Investimento: <strong>R$ 9,90</strong> (valor promocional)</p>
            </div>
          `;
          await simulateTyping(imagesHTML);
          await simulateTyping("O Ebook B√°sico oferece 50 receitas saborosas, sem gl√∫ten e sem lactose, perfeitas para uma alimenta√ß√£o mais saud√°vel e equilibrada. Por apenas R$ 9,90, clique no bot√£o abaixo para finalizar.");
          await showBuyOptions();
        } else if (lower.includes("mais informa√ß√µes")) {
          if (currentPackage === 'completo') {
            await simulateTyping("Claro! O Pacote Completo inclui 125 receitas de p√£es sem gl√∫ten, acesso vital√≠cio a todas as atualiza√ß√µes, comunidade exclusiva no WhatsApp, contato direto comigo e 6 e-books extras com t√©cnicas avan√ßadas. Por R$ 19,90, clique no bot√£o abaixo para finalizar.");
          } else {
            await simulateTyping("Claro! O Ebook B√°sico oferece 50 receitas saud√°veis, sem gl√∫ten e sem lactose, testadas e aprovadas para facilitar seu dia a dia. Por R$ 9,90, clique no bot√£o abaixo para finalizar.");
          }
          await showBuyOptions();
        } else if (lower.includes("quero o pacote completo") || lower.includes("quero o completo")) {
          currentPackage = 'completo';
          await simulateTyping(getRandomPersonalized());
          await simulateTyping("O Pacote Completo inclui 125 receitas de p√£es sem gl√∫ten, acesso vital√≠cio, comunidade exclusiva no WhatsApp, contato direto comigo e 6 e-books extras. Por R$ 19,90, clique no bot√£o abaixo para finalizar.");
          await showBuyOptions();
        } else if (lower.includes("50 receitas") || lower.includes("sim, quero comprar") || lower.includes("quero as 50")) {
          currentPackage = 'basico';
          await simulateTyping(getRandomPersonalized());
          await simulateTyping("O Ebook B√°sico oferece 50 receitas saborosas, sem gl√∫ten e sem lactose, perfeitas para uma alimenta√ß√£o mais saud√°vel e equilibrada. Por R$ 9,90, clique no bot√£o abaixo para finalizar.");
          await showBuyOptions();
        } else {
          await simulateTyping(getRandomPersonalized());
          await showBuyOptions();
        }
      }

      async function handlePurchaseClick(packageType) {
        appendMessage("user", packageType === 'completo' ? 'Quero o Pacote Completo' : 'Quero as 50 Receitas');
        await simulateTyping("√ìtima escolha! Em breve voc√™ ser√° redirecionado para finalizar a compra.");
        setTimeout(() => {
          window.location.href = packageType === 'completo' ? CHECKOUT_COMPLETO : CHECKOUT_BASICO;
        }, 1000);
      }

      async function showBuyOptions() {
        conversationStage = 2;
        if (currentPackage === 'basico') {
          appendMessage("bot", `
            <div class="buy-options">
              <button class="buy-button" onclick="handlePurchaseClick('basico')">
                QUERO AS 50 RECEITAS - R$ 9,90
              </button>
            </div>
          `);
          await simulateTyping("Ou, se preferir, voc√™ pode adquirir o Pacote Completo com muito mais conte√∫do:");
          appendMessage("bot", `
            <div class="buy-options">
              <button class="buy-button" onclick="handlePurchaseClick('completo')">
                QUERO O PACOTE COMPLETO - R$ 19,90
              </button>
            </div>`);
        } else {
          appendMessage("bot", `
            <div class="buy-options">
              <button class="buy-button" onclick="handlePurchaseClick('completo')">
                QUERO O PACOTE COMPLETO - R$ 19,90
              </button>
            </div>
          `);
        }
        await simulateTyping("Qualquer d√∫vida √© s√≥ me chamar! üòä");
      }

      function handleKeyPress(event) {
        if (event.key === 'Enter' && !isWaitingResponse) {
          sendMessage();
        }
      }

      async function sendMessage() {
        if (isWaitingResponse) return;
        const text = userInput.value.trim();
        if (!text) return;
        appendMessage("user", text);
        userInput.value = "";
        updateActionIcon();
        isWaitingResponse = true;
        showTypingIndicator();

        const lower = text.toLowerCase();
        const normalized = lower.normalize('NFD').replace(/[\u0300-\u036f]/g, '');

        // Perguntas sobre Larissa ou sobre o bot
        if (normalized.includes('quem e larissa') || normalized.includes('quem √© larissa') ||
            normalized.includes('quem e voce') || normalized.includes('quem √© voc√™') ||
            normalized.includes('quem e vc') || normalized.includes('quem √© vc') ||
            (normalized.includes('de onde') && normalized.includes('larissa')) ||
            normalized.includes('onde mora') || normalized.includes('onde vive') ||
            normalized.includes('vc √© de onde') || normalized.includes('voc√™ √© de onde')) {
          hideTypingIndicator();
          await showLarissaProfile();
          isWaitingResponse = false;
          return;
        }
        // Redes sociais
        if (normalized.includes('instagram') || normalized.includes('facebook') || normalized.includes('rede social') || normalized.includes('seguir')) {
          hideTypingIndicator();
          await simulateTyping("Siga-me:\nhttps://www.instagram.com/receitinhasdalari\nhttps://www.facebook.com/share/1ErC8vLffa/");
          if (currentPackage === 'completo') {
            appendMessage("bot", `
              <div class="buy-options">
                <button class="buy-button" onclick="handlePurchaseClick('completo')">
                  üåü Quero o Pacote Completo
                </button>
              </div>`);
          } else if (currentPackage === 'basico') {
            await showBuyOptions();
          } else {
            appendMessage("bot", `
              <div class="option-buttons">
                <button class="option-button" onclick="handleOptionClick('As 50 Receitas')">As 50 Receitas ‚ù§Ô∏è</button>
                <button class="option-button" onclick="handleOptionClick('Pacote Completo')">Pacote Completo ü•π</button>
              </div>`);
          }
          isWaitingResponse = false;
          return;
        }
        // Confiabilidade
        if (isTrustQuestion(text)) {
          hideTypingIndicator();
          await handleTrustQuestion(text);
          isWaitingResponse = false;
          return;
        }
        // Como comprar
        if (normalized.includes('como comprar') || normalized.includes('como faco para comprar') || normalized.includes('como fa√ßo para comprar') || normalized.includes('processo de compra') || normalized.includes('como funciona a compra')) {
          hideTypingIndicator();
          await showHowToBuy();
          isWaitingResponse = false;
          return;
        }
        // Sem gl√∫ten/lactose
        if (normalized.includes('celiaca') || normalized.includes('celiaco') ||
            (normalized.includes('intolerante') && (normalized.includes('lactose') || normalized.includes('gluten'))) ||
            normalized.includes('sem gl√∫ten') || normalized.includes('sem gluten') ||
            normalized.includes('sem lactose')) {
          hideTypingIndicator();
          await simulateTyping("Todas as receitas s√£o 100% sem gl√∫ten e sem lactose, adequadas para intolerantes.");
          if (currentPackage === 'completo') {
            appendMessage("bot", `
              <div class="buy-options">
                <button class="buy-button" onclick="handlePurchaseClick('completo')">
                  üåü Quero o Pacote Completo
                </button>
              </div>`);
          } else if (currentPackage === 'basico') {
            await showBuyOptions();
          } else {
            appendMessage("bot", `
              <div class="option-buttons">
                <button class="option-button" onclick="handleOptionClick('As 50 Receitas')">As 50 Receitas ‚ù§Ô∏è</button>
                <button class="option-button" onclick="handleOptionClick('Pacote Completo')">Pacote Completo ü•π</button>
              </div>`);
          }
          isWaitingResponse = false;
          return;
        }
        // Pagamento/recebimento
        if ((normalized.includes('recebo') || normalized.includes('receber') || normalized.includes('quando recebo') ||
            normalized.includes('como recebo') || normalized.includes('envio do ebook') ||
            normalized.includes('pagamento') || normalized.includes('cobranca') ||
            normalized.includes('confirmar pagamento') || normalized.includes('recebimento'))) {
          hideTypingIndicator();
          await simulateTyping("Ap√≥s confirma√ß√£o, envio o e-book por e-mail em minutos. Se n√£o receber, verifique spam ou avise-me.");
          if (currentPackage === 'completo') {
            appendMessage("bot", `
              <div class="buy-options">
                <button class="buy-button" onclick="handlePurchaseClick('completo')">
                  üåü Quero o Pacote Completo
                </button>
              </div>`);
          } else if (currentPackage === 'basico') {
            await showBuyOptions();
          } else {
            appendMessage("bot", `
              <div class="option-buttons">
                <button class="option-button" onclick="handleOptionClick('As 50 Receitas')">As 50 Receitas ‚ù§Ô∏è</button>
                <button class="option-button" onclick="handleOptionClick('Pacote Completo')">Pacote Completo ü•π</button>
              </div>`);
          }
          isWaitingResponse = false;
          return;
        }
        // Diferen√ßa entre e-books
        if (normalized.includes('diferenca') || normalized.includes('diferen√ßa') || normalized.includes('comparar') || normalized.includes('oq muda') || normalized.includes('oque muda') || normalized.includes('o que muda')) {
          hideTypingIndicator();
          await simulateTyping("B√°sico: 50 receitas sem gl√∫ten e lactose, acesso vital√≠cio, suporte. R$ 9,90. Completo: 125 receitas, comunidade, contato direto, atualiza√ß√µes e 6 b√¥nus. R$ 19,90.");
          await showBuyOptions();
          isWaitingResponse = false;
          return;
        }
        // Comunidade
        if (normalized.includes('comunidade') || normalized.includes('whatsapp') || normalized.includes('grupo') || normalized.includes('contato direto')) {
          hideTypingIndicator();
          await simulateTyping("No Pacote Completo voc√™ tem tanto a comunidade exclusiva quanto contato direto comigo via WhatsApp. Para participar, clique no bot√£o.");
          appendMessage("bot", `
            <div class="buy-options">
              <button class="buy-button" onclick="handlePurchaseClick('completo')">
                üåü Quero o Pacote Completo
              </button>
            </div>`);
          isWaitingResponse = false;
          return;
        }
        // Acesso m√≥vel
        if ((normalized.includes('acessar') && normalized.includes('celular')) || normalized.includes('pelo celular') || normalized.includes('no cel')) {
          hideTypingIndicator();
          await simulateTyping("Voc√™ pode acessar tudo pelo celular, tablet ou computador.");
          if (currentPackage) {
            await showBuyOptions();
          } else {
            appendMessage("bot", `
              <div class="option-buttons">
                <button class="option-button" onclick="handleOptionClick('As 50 Receitas')">As 50 Receitas ‚ù§Ô∏è</button>
                <button class="option-button" onclick="handleOptionClick('Pacote Completo')">Pacote Completo ü•π</button>
              </div>`);
          }
          isWaitingResponse = false;
          return;
        }
        // Imprimir
        if (normalized.includes('imprimir') || normalized.includes('impressa')) {
          hideTypingIndicator();
          await simulateTyping("Os arquivos s√£o PDF e podem ser baixados e impressos.");
          if (currentPackage) {
            await showBuyOptions();
          } else {
            appendMessage("bot", `
              <div class="option-buttons">
                <button class="option-button" onclick="handleOptionClick('As 50 Receitas')">As 50 Receitas ‚ù§Ô∏è</button>
                <button class="option-button" onclick="handleOptionClick('Pacote Completo')">Pacote Completo ü•π</button>
              </div>`);
          }
          isWaitingResponse = false;
          return;
        }
        // Seguran√ßa Kiwify
        if ((normalized.includes('kiwify') && (normalized.includes('segura') || normalized.includes('confiavel'))) || normalized.includes('segura kiwify')) {
          hideTypingIndicator();
          await simulateTyping("Kiwify √© segura e muito usada no Brasil.");
          if (currentPackage) {
            await showBuyOptions();
          } else {
            appendMessage("bot", `
              <div class="option-buttons">
                <button class="option-button" onclick="handleOptionClick('As 50 Receitas')">As 50 Receitas ‚ù§Ô∏è</button>
                <button class="option-button" onclick="handleOptionClick('Pacote Completo')">Pacote Completo ü•π</button>
              </div>`);
          }
          isWaitingResponse = false;
          return;
        }
        // Formas de pagamento
        if (normalized.includes('pix') || normalized.includes('boleto') || normalized.includes('cartao') || normalized.includes('forma de pagamento') || normalized.includes('parcelado') || normalized.includes('parcelamento')) {
          hideTypingIndicator();
          if (normalized.includes('parcelado') || normalized.includes('parcelamento')) {
            await simulateTyping("Eu n√£o aceito pagamento parcelado por j√° ser um valor de baixo custo e promocional. Aceito apenas Cart√£o (√† vista), Pix e boleto.");
          } else {
            await simulateTyping("Aceito Pix, boleto e cart√£o (somente √† vista) via Kiwify.");
          }
          if (currentPackage) {
            await showBuyOptions();
          } else {
            appendMessage("bot", `
              <div class="option-buttons">
                <button class="option-button" onclick="handleOptionClick('As 50 Receitas')">As 50 Receitas ‚ù§Ô∏è</button>
                <button class="option-button" onclick="handleOptionClick('Pacote Completo')">Pacote Completo ü•π</button>
              </div>`);
          }
          isWaitingResponse = false;
          return;
        }
        // E-books extras do completo
        if ((normalized.includes('6 ebooks') || normalized.includes('6 e-books') || normalized.includes('ebooks extras') || normalized.includes('extras pacote completo')) && normalized.includes('completo')) {
          hideTypingIndicator();
          await simulateTyping("S√£o 6 b√¥nus: doces sem a√ß√∫car, bolos sem gl√∫ten, panetones & chocotones, fermenta√ß√£o natural, substitui√ß√µes e p√£es tran√ßados.");
          appendMessage("bot", `
            <div class="buy-options">
              <button class="buy-button" onclick="handlePurchaseClick('completo')">
                üåü Quero o Pacote Completo
              </button>
            </div>`);
          isWaitingResponse = false;
          return;
        }
        // Suporte t√©cnico
        if (normalized.includes('suporte') || normalized.includes('profissional') || normalized.includes('especialista')) {
          hideTypingIndicator();
          await simulateTyping("Suporte via WhatsApp: no B√°sico falo diretamente com voc√™; no Completo, al√©m do contato direto, voc√™ tamb√©m tem acesso √† comunidade exclusiva.");
          if (currentPackage === 'completo') {
            appendMessage("bot", `
              <div class="buy-options">
                <button class="buy-button" onclick="handlePurchaseClick('completo')">
                  üåü Quero o Pacote Completo
                </button>
              </div>`);
          } else {
            await showBuyOptions();
          }
          isWaitingResponse = false;
          return;
        }
        // Conte√∫do sem clicar bot√£o
        if ((normalized.includes('conteudo') || normalized.includes('o que tem') || normalized.includes('quais') || normalized.includes('oq vem') || normalized.includes('oque vem') || normalized.includes('oque tem')) &&
            normalized.includes('pacote completo')) {
          hideTypingIndicator();
          if (!shownCompletoDetails) {
            shownCompletoDetails = true;
            await simulateTyping("O Pacote Completo inclui Guia P√£es Sem Gl√∫ten com 125 receitas, acesso vital√≠cio com todas as atualiza√ß√µes, comunidade exclusiva no WhatsApp, contato direto comigo e 6 e-books extras. Tudo por R$ 19,90.");
          } else {
            await simulateTyping("Pacote Completo: 125 receitas sem gl√∫ten + comunidade + contato direto + 6 b√¥nus + acesso vital√≠cio. R$ 19,90.");
          }
          currentPackage = 'completo';
          appendMessage("bot", `
            <div class="buy-options">
              <button class="buy-button" onclick="handlePurchaseClick('completo')">
                üåü Quero o Pacote Completo
              </button>
            </div>`);
          isWaitingResponse = false;
          return;
        }
        if ((normalized.includes('conteudo') || normalized.includes('o que tem') || normalized.includes('quais') || normalized.includes('oq vem') || normalized.includes('oque vem') || normalized.includes('oque tem')) &&
            (normalized.includes('50 receitas') || normalized.includes('ebook basico') || normalized.includes('basico'))) {
          hideTypingIndicator();
          if (!shownBasicoDetails) {
            shownBasicoDetails = true;
            await simulateTyping("O Ebook B√°sico oferece 50 receitas saborosas, sem gl√∫ten e sem lactose, ingredientes de f√°cil acesso, suporte via WhatsApp e acesso vital√≠cio. Por apenas R$ 9,90.");
          } else {
            await simulateTyping("Ebook B√°sico: 50 receitas sem gl√∫ten e sem lactose, suporte e acesso vital√≠cio. R$ 9,90.");
          }
          currentPackage = 'basico';
          await showBuyOptions();
          isWaitingResponse = false;
          return;
        }
        // Interesse direto
        const purchaseIntent = detectPurchaseIntent(text);
        if (purchaseIntent) {
          hideTypingIndicator();
          if (purchaseIntent.package === 'completo') {
            currentPackage = 'completo';
            if (!shownCompletoDetails) {
              shownCompletoDetails = true;
              await simulateTyping("Pacote Completo: 125 receitas, comunidade, contato direto e 6 b√¥nus. R$ 19,90.");
            } else {
              await simulateTyping("Pacote Completo por R$ 19,90.");
            }
            appendMessage("bot", `
              <div class="buy-options">
                <button class="buy-button" onclick="handlePurchaseClick('completo')">
                  üåü Quero o Pacote Completo
                </button>
              </div>`);
          } else {
            currentPackage = 'basico';
            if (!shownBasicoDetails) {
              shownBasicoDetails = true;
              await simulateTyping("Ebook B√°sico: 50 receitas sem gl√∫ten e sem lactose. R$ 9,90.");
            } else {
              await simulateTyping("Ebook B√°sico por R$ 9,90.");
            }
            await showBuyOptions();
          }
          isWaitingResponse = false;
          return;
        }
        // Fora do fluxo: usar Gemini
        hideTypingIndicator();
        const systemPrompt = buildSystemPrompt(text);
        const finalPrompt = systemPrompt + "\n\nCliente: " + text + "\nLarissa:";
        try {
          showTypingIndicator();
          const res = await fetch(`${GEMINI_URL}?key=${GEMINI_API_KEY}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              contents: [{ parts: [{ text: finalPrompt }] }]
            })
          });
          const data = await res.json();
          hideTypingIndicator();
          let reply = "N√£o entendi. Pode reformular?";
          if (!data.error && data.candidates && data.candidates[0] && data.candidates[0].content && data.candidates[0].content.parts[0].text) {
            reply = data.candidates[0].content.parts[0].text.trim();
          }
          await simulateTyping(reply);
          const postIntent = detectPurchaseIntent(reply);
          if (postIntent) {
            if (postIntent.package === 'completo') {
              currentPackage = 'completo';
              appendMessage("bot", `
                <div class="buy-options">
                  <button class="buy-button" onclick="handlePurchaseClick('completo')">
                    üåü Quero o Pacote Completo
                  </button>
                </div>`);
            } else {
              currentPackage = 'basico';
              await showBuyOptions();
            }
          }
        } catch (err) {
          hideTypingIndicator();
          appendMessage("bot", "Erro ao processar. Tente novamente.");
          appendMessage("bot", `
            <div class="option-buttons">
              <button class="option-button" onclick="handleOptionClick('As 50 Receitas')">As 50 Receitas ‚ù§Ô∏è</button>
              <button class="option-button" onclick="handleOptionClick('Pacote Completo')">Pacote Completo ü•π</button>
            </div>`);
        } finally {
          isWaitingResponse = false;
        }
      }

      function detectPurchaseIntent(message) {
        const lowerMsg = message.toLowerCase();
        if (lowerMsg.includes('quero o pacote completo') || lowerMsg.includes('125 receitas') || lowerMsg.includes('pacote completo')) {
          return { package: 'completo' };
        }
        if (lowerMsg.includes('quero as 50 receitas') || lowerMsg.includes('ebook b√°sico') || lowerMsg.includes('50 receitas') || lowerMsg.includes('b√°sico') || lowerMsg.includes('basico')) {
          return { package: 'basico' };
        }
        if (lowerMsg.includes('quero comprar') || lowerMsg.includes('adquirir') || lowerMsg.includes('garantir')) {
          return { package: currentPackage || 'basico' };
        }
        return null;
      }

      function isTrustQuestion(message) {
        const lowerMsg = message.toLowerCase();
        return (
          lowerMsg.includes('confi√°vel') ||
          lowerMsg.includes('confiavel') ||
          lowerMsg.includes('golpe') ||
          lowerMsg.includes('seguro') ||
          lowerMsg.includes('verdade') ||
          lowerMsg.includes('mentira') ||
          lowerMsg.includes('depoimento') ||
          lowerMsg.includes('prova') ||
          lowerMsg.includes('real') ||
          lowerMsg.includes('credibilidade')
        );
      }

      async function handleTrustQuestion(message) {
        await simulateTyping("Pode ficar tranquila! Todos meus materiais s√£o digitais e entregues automaticamente ap√≥s a compra.");
        appendMessage("bot", `<img src="depoimento.webp" alt="Depoimentos" class="testimonial-image">`);
        await simulateTyping("Aqui est√° a prova do carinho dos meus clientes! S√£o receitas que realmente funcionam e fazem a diferen√ßa. A Kiwify garante sua compra com seguran√ßa total.");
        if (conversationStage >= 1) {
          await showBuyOptions();
        } else {
          appendMessage("bot", `
            <div class="option-buttons">
              <button class="option-button" onclick="handleOptionClick('As 50 Receitas')">As 50 Receitas ‚ù§Ô∏è</button>
              <button class="option-button" onclick="handleOptionClick('Pacote Completo')">Pacote Completo ü•π</button>
            </div>`);
        }
      }

      async function showLarissaProfile() {
        const profileHTML = `
          <img src="larissa.webp" alt="Larissa Campos" class="profile-image">
          <p>Eu sou a Larissa Campos, nutricionista e chef de Florian√≥polis (SC). Minha paix√£o pela cozinha come√ßou por amor ‚Äî amor pela minha m√£e, que tem intoler√¢ncia √† lactose, e pelo meu irm√£o, que √© cel√≠aco.</p>
          <p>Crio receitas sem gl√∫ten e sem lactose que sejam simples, gostosas e acolhedoras, para ajudar pessoas a redescobrirem o prazer de comer bem.</p>
        `;
        await simulateTyping(profileHTML);
        if (conversationStage === 0) {
          appendMessage("bot", `
            <div class="option-buttons">
              <button class="option-button" onclick="handleOptionClick('As 50 Receitas')">As 50 Receitas ‚ù§Ô∏è</button>
              <button class="option-button" onclick="handleOptionClick('Pacote Completo')">Pacote Completo ü•π</button>
            </div>`);
        }
      }

      async function showHowToBuy() {
        await simulateTyping("<p>A compra √© bem simples e segura:</p><p>1. Clique no bot√£o do e-book escolhido.</p><p>2. Ser√° redirecionado para a plataforma Kiwify.</p><p>3. Preencha seus dados e forma de pagamento.</p><p>4. Ap√≥s confirma√ß√£o do pagamento, voc√™ recebe o e-book por e-mail em minutos.</p><p>5. Se n√£o receber, verifique sua caixa de spam ou me avise.</p>");
        if (currentPackage) {
          await showBuyOptions();
        } else {
          appendMessage("bot", `
            <div class="option-buttons">
              <button class="option-button" onclick="handleOptionClick('As 50 Receitas')">As 50 Receitas ‚ù§Ô∏è</button>
              <button class="option-button" onclick="handleOptionClick('Pacote Completo')">Pacote Completo ü•π</button>
            </div>`);
        }
      }

      function showTypingIndicator() {
        if (!typingEl) {
          typingEl = document.createElement("div");
          typingEl.className = "typing-indicator";
          typingEl.innerHTML = "<span></span><span></span><span></span>";
          document.getElementById("chatBody").appendChild(typingEl);
          document.getElementById("chatBody").scrollTop = document.getElementById("chatBody").scrollHeight;
        }
      }

      function hideTypingIndicator() {
        if (typingEl) {
          typingEl.remove();
          typingEl = null;
        }
      }

      async function simulateTyping(message, delay = 1500) {
        showTypingIndicator();
        await new Promise(r => setTimeout(r, delay));
        hideTypingIndicator();
        if (message) {
          appendMessage("bot", message);
        }
      }

      function appendMessage(sender, message) {
        const chatBody = document.getElementById("chatBody");
        const msgEl = document.createElement("div");
        msgEl.className = `message ${sender}`;
        msgEl.innerHTML = message;
        chatBody.appendChild(msgEl);
        chatBody.scrollTop = chatBody.scrollHeight;
      }
    </script>
  </body>
</html>
